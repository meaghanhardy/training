--FIND/REPLACE: YYYYMMDD
--FIND/REPLACE: EAXXX (db stateid)
--FIND/REPLACE: ClientName
--FIND/REPLACE: 'XXXXX'(CommitteeID)
--FIND/REPLACE: '##' (USERID)
--FIND/PRELACE: ##YourExternalIDTypeID##-->will need to replace this at some point
--FIND/REPLACE: YourNamek1-->necessary for your contacts insert
--FIND/REPLACE: ContactIPK (the source unique id/PK)

--IF DOING RESEARCH, THE FILES ARE NAMED SOMETHING LIKE EAXXX_SampleClientNameSourceYYYYMMDD, AND USUALLY PLACED IN STAGING1 ON .186
--IF THERE ARE MULTIPLE FILES(EVEN SAMPLES) NAME THE SOURCE/PERSON FILE EAXXX_ClientNameSourceYYYYMMDD, AND GIVE THE OTHER FILES EXTENSIONS FOR THER ORIGINAL FILE NAME, AND USUALLY PLACE 
--THE SOURCE FILES IN THE STAGING FOR THE DB'S SERVER
--EXAMPLES: EAXXX_ClientNameSourceYYYYMMDD_Contributions, EAXXX_ClientNameSourceYYYYMMDD_EmailHistory, EAXXX_ClientNameSourceYYYYMMDD_SalsaGroups, EAXXX_ClientNameSourceYYYYMMDD_Supporters, etc.

--BASIC FILE CLEANUP WORK DONE BEFORE DELVING INTO THE DATA
use staging1

select top 1000 *--select count(*)--4358
from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD

--THEIR UNIQUE ID?
select contactipk, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by contactipk having count(*)>1

--is it duplicated? can't hurt to try this
usp_distinctivize EAXXX_ClientNameSourceYYYYMMDD

--let's clean up the column names shall we?
select 'exec sp_rename ''EAXXX_ClientNameSourceYYYYMMDD.'+ column_name + ''',''' + replace(column_name,' ','') + ''';'
from information_schema.columns where table_name = 'EAXXX_ClientNameSourceYYYYMMDD' and column_name like '% %'

--When we receive an excel file, and actually have to import from excel format(for some stupid reason), the import will usually break on trucation errors for some stupid f'ing comment/note
--column bc it's longer than 255 characters; adding a fake 1st row w/ this copied into the offending column will usually solve that issue; immediately delete the row after import
delete EAXXX_ClientNameSourceYYYYMMDD
where contactcomments='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

select len(contactcomments), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len(contactcomments)
order by len(contactcomments)

--drop table EAXXX_ClientNameSourceYYYYMMDD

--using usp_resize is usually no good bc if the column is too long it'll drop the original file too early
usp_ResizeTablesWithLongAssColumns EAXXX_ClientNameSourceYYYYMMDD

select top 1000 *--select count(*)--4776
from EAXXX_ClientNameSourceYYYYMMDD
where donationmethodofpayment='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

delete EAXXX_ClientNameSourceYYYYMMDD
where donationmethodofpayment='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

--when there's a bunch of garbage columns, can i drop them?
select sql=column_name+' is not null or',* from information_schema.columns where table_name='EAXXX_ClientNameSourceYYYYMMDD'
and ordinal_position>128

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where F129 is not null or F130 is not null or F131 is not null or F132 is not null or F133 is not null or F134 is not null or F135 is not null or F136 is not null or F137 is not null or
F138 is not null or F139 is not null or F140 is not null or F141 is not null or F142 is not null or F143 is not null or F144 is not null or F145 is not null or F146 is not null or 
F147 is not null or F148 is not null or F149 is not null or F150 is not null or F151 is not null or F152 is not null or F153 is not null or F154 is not null or F155 is not null or
F156 is not null or F157 is not null or F158 is not null or F159 is not null or F160 is not null or F161 is not null or F162 is not null or F163 is not null or F164 is not null or
F165 is not null or F166 is not null or F167 is not null or F168 is not null or F169 is not null or F170 is not null or F171 is not null or F172 is not null or F173 is not null or
F174 is not null or F175 is not null or F176 is not null or F177 is not null or F178 is not null or F179 is not null or F180 is not null or F181 is not null or F182 is not null or
F183 is not null or F184 is not null or F185 is not null or F186 is not null or F187 is not null or F188 is not null or F189 is not null or F190 is not null or F191 is not null or
F192 is not null or F193 is not null or F194 is not null or F195 is not null or F196 is not null or F197 is not null or F198 is not null or F199 is not null or F200 is not null or
F201 is not null or F202 is not null or F203 is not null or F204 is not null or F205 is not null or F206 is not null or F207 is not null or F208 is not null or F209 is not null or
F210 is not null or F211 is not null or F212 is not null or F213 is not null or F214 is not null or F215 is not null or F216 is not null or F217 is not null or F218 is not null or
F219 is not null or F220 is not null or F221 is not null or F222 is not null or F223 is not null or F224 is not null or F225 is not null or F226 is not null or F227 is not null or
F228 is not null or F229 is not null or F230 is not null or F231 is not null or F232 is not null or F233 is not null or F234 is not null or F235 is not null or F236 is not null or
F237 is not null or F238 is not null or F239 is not null or F240 is not null or F241 is not null or F242 is not null or F243 is not null or F244 is not null or F245 is not null or
F246 is not null or F247 is not null or F248 is not null or F249 is not null or F250 is not null or F251 is not null or F252 is not null or F253 is not null or F254 is not null or
F255 is not null or F256 is not null

select sql=column_name+', ',* from information_schema.columns where table_name='EAXXX_ClientNameSourceYYYYMMDD' and ordinal_position>128

alter table EAXXX_ClientNameSourceYYYYMMDD drop column F129, F130, F131, F132, F133, F134, F135, F136, F137, F138, F139, F140, F141, F142, F143, F144, F145, F146, F147, F148, F149, F150, F151, 
F152, F153, F154, F155, F156, F157, F158, F159, F160, F161, F162, F163, F164, F165, F166, F167, F168, F169, F170, F171, F172, F173, F174, F175, F176, F177, F178, F179, F180, F181, F182, F183, F184, 
F185, F186, F187, F188, F189, F190, F191, F192, F193, F194, F195, F196, F197, F198, F199, F200, F201, F202, F203, F204, F205, F206, F207, F208, F209, F210, F211, F212, F213, F214, F215, F216, F217, 
F218, F219, F220, F221, F222, F223, F224, F225, F226, F227, F228, F229, F230, F231, F232, F233, F234, F235, F236, F237, F238, F239, F240, F241, F242, F243, F244, F245, F246, F247, F248, F249, F250, 
F251, F252, F253, F254, F255, F256

--some more cleanup?
select sql='['+column_name+'] like ''%"%'' or ',*
from information_schema.columns where table_name = 'EAXXX_ClientNameSourceYYYYMMDD'

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD
where

--this would be a legit issue
select sql='['+column_Name+']=''null'' or ',* from information_schema.columns where table_name='EAXXX_ClientNameSourceYYYYMMDD'

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD
where 

select sql='['+column_name+']=nullif(['+column_name+'],''null''),',*
from information_schema.columns where table_name = 'EAXXX_ClientNameSourceYYYYMMDD'

update EAXXX_ClientNameSourceYYYYMMDD set 

select sql='['+column_name+'] like ''%null%'' or ',*
from information_schema.columns where table_name = 'EAXXX_ClientNameSourceYYYYMMDD'

--don't think i can really do anything but want to see them
select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD
where

--to give a quick rundown of everything, more helpful in initial research
usp_GroupByAlltheFingColumns EAXXX_ClientNameSampleSourceYYYYMMDD
--USUALLY STOP HERE IF THEY HAVEN'T SIGNED AN SOW YET, THE ABOVE WORK IS RESEARCH AND INITIAL STAGES OF PREP WORK
--------------------------------------------------------------------------------------------------------------
--FOR THE REAL FILE, SHOULD AT LEAST START HERE BUT CAN DO SOME OF THE WORK ABOVE
--main source file
select top 1000 *--select count(*)--4358
from EAXXX_ClientNameSourceYYYYMMDD

usp_ResizeTablesWithLongAssColumns EAXXX_ClientNameSourceYYYYMMDD

--whatever their unique person id; this usually becomes an external id of some sort if it's unique
select [ContactIPK], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [ContactIPK] having count(*)>1
order by [ContactIPK]

--the existing ones we use; if it doesn't fit these then we use the generic "EveryAction Client ID"
select top 1000 * from van_main_copy.dbo.externalidtypes where externalidtypename in('EveryAction Client ID','BSD ID','Salsa ID','SalesForce ID','NationBuilder ID','Databank ID',
'Donor Perfect ID','DonorSnap ID','eTapestry ID','Raiser''s Edge ID','EveryAction7 ID')

--If their ID is supposed to match to other files, do any of the IDs in the main file not exist in other files and vice versa
select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a left join EAXXX_ClientNameSourceYYYYMMDD_otherfile b
on a.[ContactIPK]=b.[ContactIPK]
where b.[ContactIPK] is null

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD_otherfile a left join EAXXX_ClientNameSourceYYYYMMDD b
on a.[ContactIPK]=b.[ContactIPK]
where b.[ContactIPK] is null

--still going to create my unique id
usp_identityPK EAXXX_ClientNameSourceYYYYMMDD
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
--ADDRESSES
--THE ADDRESS DESTINATION TABLES(_Vaddress, _Maddress, etc) AND COLUMN NAMES SHOULD NEVER CHANGE NOR SHOULD YOU ADD EXTRA COLUMNS UNTIL AFTER POSTMELISSA PROC
--OTHERWISE ADDRESS PROCESSING WILL NOT WORK

--NOTE(3/10): WE NEED TO START ASKING FOR COUNTRY FOR EACH SET OF ADDRESSES. IF THE CLIENT DOES NOT PROVIDE COUNTRY, WE HAVE TO ASSUME THAT THE ADDRESS IS US

--PHYSICAL ADDRESSES/VADDRESSES
--
select [Address1], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Address1]
order by [Address1]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where address1 is not null

--USUALLY APTS
select [Address2], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Address2]
order by [Address2]

--
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
--where address1 is not null and address2 is not null
where address1 is null and address2 is not null--00

--IN THIS EXAMPLE, THERE WAS NO ADDRESSES SO SKIPPED
select [Address3], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Address3]
order by [Address3]

--
select [City], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [City]
order by [City]

--
select [State/Province], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [State/Province]
order by [State/Province]

--IF YOU'RE GIVEN A COMBINED ZIPCODE COLUMN
--this part will never be perfect, feel free to adapt the zip queries below to suit your needs
select [Zip/Postal Code], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Zip/Postal Code]
order by [Zip/Postal Code]

--all over the place
select len([Zip/Postal Code]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([Zip/Postal Code])
order by len([Zip/Postal Code])

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len([Zip/Postal Code]) not in('10','5')

--IF YOU'RE GIVEN A COMBINED ZIP5 AND ZIP4 COLUMN
select private_zip_plus_4, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by private_zip_plus_4
order by private_zip_plus_4

--all over the place
select len(private_zip_plus_4), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len(private_zip_plus_4)
order by len(private_zip_plus_4)

--IF THEY DON'T HAVE A COUNTRY WE HAVE TO ASSUME IT'S ALL US UNLESS OTHERWISE NOTED
select [Country], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Country]
order by [Country]

--this is where you grab the country code
select * from van_main_copy.dbo.isocountries

alter table EAXXX_ClientNameSourceYYYYMMDD add CountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD set countrycode=b.countrycode
from EAXXX_ClientNameSourceYYYYMMDD a, van_main_copy.dbo.isocountries b
where where a.country=b.countryname

--look to see if any of the countries need to manually be matched
select [Country], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where countrycode is null
group by [Country]
order by [Country]

--intentionally leaving null countries w/ a null countrycode; fill in and add as necessary
update EAXXX_ClientNameSourceYYYYMMDD set countrycode=case 
when country='' then ''
when country='' then ''
when country='' then ''
else countrycode end

select top 1000 *--select count(*)--4358
from EAXXX_ClientNameSourceYYYYMMDD
where [City] is null and [Zip/Postal Code] is null and [State/Province] is null--
and (address1 is not null or address2 is not null)

--Because it's an EA/MC db, take whatever address parts you can
select --1000
k1,
SrcAddress=nullif(nullif(ltrim(rtrim(IsNull([Address1],'') + ' ' +IsNull([Address2],''))),' '),''),
SrcCity=[City],
SrcState=[State/Province],
SrcZip=case when len([Zip/Postal Code])=9 and right([Zip/Postal Code],4)!='0000' then left([Zip/Postal Code],5)+'-'+right([Zip/Postal Code],4)
    when len([Zip/Postal Code])=10 and right([Zip/Postal Code],4)!='0000' and left(right([Zip/Postal Code],5),1) = '-' then [Zip/Postal Code]
    when len([Zip/Postal Code])=4 AND [State/Province] IN ('ME', 'NH', 'VT', 'CT', 'RI', 'MA', 'NJ', 'NY') THEN '0'+[Zip/Postal Code]
    when len([Zip/Postal Code])=3 AND [State/Province] IN ('PR','VI','AE') THEN '00'+[Zip/Postal Code]
    when len([Zip/Postal Code])=4 AND [State/Province] IS NULL THEN '0'+[Zip/Postal Code]
	else left([Zip/Postal Code],5) END
--SrcZip=case when len(dbo.numericonly(private_zip_plus_4))=5 and [Zip/Postal Code] is null then dbo.numericonly(private_zip_plus_4)
--			when len(dbo.numericonly(private_zip_plus_4))=4 and len(dbo.numericonly([Zip/Postal Code]))=4 then '0'+dbo.numericonly([Zip/Postal Code])+'-'+dbo.numericonly(private_zip_plus_4)
--			when len(dbo.numericonly(private_zip_plus_4))=4 and len(dbo.numericonly([Zip/Postal Code]))=5 then left(dbo.numericonly([Zip/Postal Code]),5)+'-'+dbo.numericonly(private_zip_plus_4)
--			when len(dbo.numericonly([Zip/Postal Code]))=9 and right(dbo.numericonly([Zip/Postal Code]),4)!='0000' then left(dbo.numericonly([Zip/Postal Code]),5)+'-'+right(dbo.numericonly([Zip/Postal Code]),4)
--			when len(dbo.numericonly([Zip/Postal Code]))=4 and len([Zip/Postal Code])=4 then '0'+[Zip/Postal Code]
--			when len(dbo.numericonly([Zip/Postal Code]))=5 and len([Zip/Postal Code])=5 then [Zip/Postal Code]
--			when len(dbo.numericonly([Zip/Postal Code]))>5 then left([Zip/Postal Code],5)--this will weed out the postal codes
-- 				else [Zip/Postal Code] END
into EAXXX_ClientNameSourceYYYYMMDD_vaddress--
from EAXXX_ClientNameSourceYYYYMMDD
where isnull(cast(countrycode as varchar(2)),'US')='US'
and ([City] is not null or [Zip/Postal Code] is not null or [State/Province] is not null or address1 is not null or address2 is not null)
order by [City]

--drop table EAXXX_ClientNameSourceYYYYMMDD_vaddress

--
select len(srczip), count(*) from EAXXX_ClientNameSourceYYYYMMDD_vaddress
group by len(srczip)
order by len(srczip)

--looks good to me
select SrcAddress, count(*) from EAXXX_ClientNameSourceYYYYMMDD_vaddress
group by SrcAddress
order by SrcAddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_vaddress
where srcaddress is null

--dupe addresses
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_vaddress where SrcAddress is not null group by SrcAddress having count(*)>1)
order by k1

select count(*) from EAXXX_ClientNameSourceYYYYMMDD_vaddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_vaddress where SrcAddress is not null
group by SrcAddress having count(*)>1)--

--messy file, do checks
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where patindex('%HC[0-9]%',SrcAddress)>0 or patindex('%HCR[0-9]%',SrcAddress)>0
or patindex('%RR[0-9]%',SrcAddress)>0 or patindex('%box[0-9]%',SrcAddress)>0 or patindex('%[^a-np-z ]box%',SrcAddress)>0 or charindex('bx',SrcAddress)>0
or  patindex('% 0[1-9]%',SrcAddress)>0
or (left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0)

--!!NEED TO DO THIS!!
update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=stuff(SrcAddress,patindex('%HC[0-9]%',SrcAddress)+2,0,' ')
where patindex('%HC[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=stuff(SrcAddress,patindex('%HCR[0-9]%',SrcAddress)+3,0,' ')
where patindex('%HCR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=stuff(SrcAddress,patindex('%RR[0-9]%',SrcAddress)+2,0,' ')
where patindex('%RR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=stuff(SrcAddress,patindex('%box[0-9]%',SrcAddress)+3,0,' ')
where patindex('%box[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=stuff(SrcAddress,patindex('%[^a-np-z ]box%',SrcAddress)+1,0,' ')
where patindex('%[^a-np-z ]box%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=replace(SrcAddress,' 0',' ')
where patindex('% 0[1-9]%',SrcAddress)>0--

--best to check these first for now
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where left(SrcAddress,2)='bx'--

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=replace(replace(SrcAddress,'BX','PO Box '),'  ',' ')
where left(SrcAddress,2)='bx'--

--and these
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where left(SrcAddress,3) in ('PO ','P.O','P O','PO.')
and charindex('box',SrcAddress)=0

select 'PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress)),* from EAXXX_ClientNameSourceYYYYMMDD_vaddress
where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
and charindex('drawer',SrcAddress)=0

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress='PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress))
	where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
	and charindex('drawer',SrcAddress)=0--

--and these as well:
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where charindex('bx',SrcAddress)>0

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set SrcAddress=replace(replace(SrcAddress,'BX',' Box '),'  ',' ')
where charindex('bx',SrcAddress)>0--
----
--on .186
use staging1

SELECT * INTO Staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_vaddress--
FROM OPENQUERY	( [10.10.0.210], 'SELECT * from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD_vaddress')

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where srccity is null

alter table EAXXX_ClientNameSourceYYYYMMDD_vaddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_vaddress primary key clustered (k1)

usp_StandardizeAddresses EAXXX_ClientNameSourceYYYYMMDD_vaddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_vaddress

usp_EAPostMelissaFixing EAXXX_ClientNameSourceYYYYMMDD_vaddress
-----------------------
--on .210(or whatever the targer server)
use staging

drop table EAXXX_ClientNameSourceYYYYMMDD_vaddress

SELECT * INTO EAXXX_ClientNameSourceYYYYMMDD_vaddress--
FROM OPENQUERY	( stagingb, 'SELECT * from staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_vaddress')

select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_vaddress

--add back your original columns in case then length was earlier truncated, make sure to not update an existing standardized address field even if that's the name from the original file
--City vs OriginalCity, etc
alter table EAXXX_ClientNameSourceYYYYMMDD_vaddress add [Address1] varchar(150), [Address2] varchar(150), [Address3] varchar(150), [OriginalCity] varchar(150), [State/Province] varchar(150),
[Zip/Postal Code] varchar(150), [private_zip_plus_4] varchar(150), [Country] varchar(150), CountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set [Address1]=b.[Address1], [Address2]=b.[Address2], [Address3]=b.[Address3], [OriginalCity]=b.[City], [State/Province]=b.[State/Province],
[Zip/Postal Code]=b.[Zip/Postal Code],[private_zip_plus_4]=b.[private_zip_plus_4],[Country]=b.[Country],CountryCode=b.CountryCode
from EAXXX_ClientNameSourceYYYYMMDD_vaddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1
--------
--back on .186
use staging1

drop table EAXXX_ClientNameSourceYYYYMMDD_vaddress
----------------------------------------------------
--Mailing Addresses
--
select [mAddress1], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mAddress1]
order by [mAddress1]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where maddress1 is not null

--USUALLY APTS
select [mAddress2], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mAddress2]
order by [mAddress2]

--
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
--where maddress1 is not null and maddress2 is not null
where maddress1 is null and maddress2 is not null--00

--IN THIS EXAMPLE, NO DATA
select [mAddress3], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mAddress3]
order by [mAddress3]

--
select [mCity], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mCity]
order by [mCity]

--
select [mState], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mState]
order by [mState]

--this part will never be perfect, feel free to adapt the zip queries below to suit your needs
select [mZip], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mZip]
order by [mZip]

--all over the place
select len([mZip]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([mZip])
order by len([mZip])

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len([mZip]) not in('10','5')

--IF YOU'RE GIVEN A COMBINED ZIP5 AND ZIP4 COLUMN
select mzip_plus_4, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by mzip_plus_4
order by mzip_plus_4

--all over the place
select len(mzip_plus_4), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len(mzip_plus_4)
order by len(mzip_plus_4)

--IF THEY DON'T HAVE A COUNTRY WE HAVE TO ASSUME IT'S ALL US UNLESS OTHERWISE NOTED
select [mCountry], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [mCountry]
order by [mCountry]

--this is where you grab the country code
select * from van_main_copy.dbo.isocountries

alter table EAXXX_ClientNameSourceYYYYMMDD add mCountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD set mcountrycode=b.countrycode
from EAXXX_ClientNameSourceYYYYMMDD a, van_main_copy.dbo.isocountries b
where a.[mCountry]=b.countryname

--look to see if any of the countries need to manually be matched
select [mCountry], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where mcountrycode is null
group by [mCountry]
order by [mCountry]

--intentionally leaving null countries w/ a null mcountrycode; fill in and add as necessary
update EAXXX_ClientNameSourceYYYYMMDD set mcountrycode=case 
when [mCountry]='' then ''
when [mCountry]='' then ''
when [mCountry]='' then ''
else mcountrycode end

select top 1000 *--select count(*)--4358
from EAXXX_ClientNameSourceYYYYMMDD
where [mCity] is null and [mZip] is null and [mState] is null--
and (maddress1 is not null or maddress2 is not null)

--Because it's an EA/MC db, take whatever address parts you can
select --1000
k1,
SrcAddress=nullif(nullif(ltrim(rtrim(IsNull([mAddress1],'') + ' ' +IsNull([mAddress2],''))),' '),''),
SrcCity=[mCity],
SrcState=[mState],
SrcZip=case when len([mZip])=9 and right([mZip],4)!='0000' then left([mZip],5)+'-'+right([mZip],4)--if there is a zip4 column, might want to incorporate
    when len([mZip])=10 and right([mZip],4)!='0000' and left(right([mZip],5),1) = '-' then [mZip]
    when len([mZip])=4 AND mstate IN ('ME', 'NH', 'VT', 'CT', 'RI', 'MA', 'NJ', 'NY') THEN '0'+[mZip]
    when len([mZip])=3 AND mstate IN ('PR','VI','AE') THEN '00'+[mZip]
    when len([mZip])=4 AND mstate IS NULL THEN '0'+[mZip]
	else left([mZip],5) END
--SrcZip=case when len(dbo.numericonly(mzip_plus_4))=5 and [mZip] is null then dbo.numericonly(mzip_plus_4)
--			when len(dbo.numericonly(mzip_plus_4))=4 and len(dbo.numericonly([mZip]))=4 then '0'+dbo.numericonly([mZip])+'-'+dbo.numericonly(mzip_plus_4)
--			when len(dbo.numericonly(mzip_plus_4))=4 and len(dbo.numericonly([mZip]))=5 then left(dbo.numericonly([mZip]),5)+'-'+dbo.numericonly(mzip_plus_4)
--			when len(dbo.numericonly([mZip]))=9 and right(dbo.numericonly([mZip]),4)!='0000' then left(dbo.numericonly([mZip]),5)+'-'+right(dbo.numericonly([mZip]),4)
--			when len(dbo.numericonly([mZip]))=4 and len([mZip])=4 then '0'+[mZip]
--			when len(dbo.numericonly([mZip]))=5 and len([mZip])=5 then [mZip]
--			when len(dbo.numericonly([mZip]))>5 then left([mZip],5)--this will weed out the postal codes
-- 				else [mZip] END
into EAXXX_ClientNameSourceYYYYMMDD_maddress--
from EAXXX_ClientNameSourceYYYYMMDD
where isnull(cast(mcountrycode as varchar(2)),'US')='US'
and ([mCity] is not null or [mZip] is not null or [mState] is not null or maddress1 is not null or maddress2 is not null)
order by [mCity]

--drop table EAXXX_ClientNameSourceYYYYMMDD_maddress

--
select len(srczip), count(*) from EAXXX_ClientNameSourceYYYYMMDD_maddress
group by len(srczip)
order by len(srczip)

--looks good to me
select SrcAddress, count(*) from EAXXX_ClientNameSourceYYYYMMDD_maddress
group by SrcAddress
order by SrcAddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_maddress
where srcaddress is null

--dupe addresses
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_maddress where SrcAddress is not null group by SrcAddress having count(*)>1)
order by k1

select count(*) from EAXXX_ClientNameSourceYYYYMMDD_maddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_maddress where SrcAddress is not null
group by SrcAddress having count(*)>1)--

--messy file, do checks
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where patindex('%HC[0-9]%',SrcAddress)>0 or patindex('%HCR[0-9]%',SrcAddress)>0
or patindex('%RR[0-9]%',SrcAddress)>0 or patindex('%box[0-9]%',SrcAddress)>0 or patindex('%[^a-np-z ]box%',SrcAddress)>0 or charindex('bx',SrcAddress)>0
or  patindex('% 0[1-9]%',SrcAddress)>0
or (left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0)

--!!NEED TO DO THIS!!
update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=stuff(SrcAddress,patindex('%HC[0-9]%',SrcAddress)+2,0,' ')
where patindex('%HC[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=stuff(SrcAddress,patindex('%HCR[0-9]%',SrcAddress)+3,0,' ')
where patindex('%HCR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=stuff(SrcAddress,patindex('%RR[0-9]%',SrcAddress)+2,0,' ')
where patindex('%RR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=stuff(SrcAddress,patindex('%box[0-9]%',SrcAddress)+3,0,' ')
where patindex('%box[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=stuff(SrcAddress,patindex('%[^a-np-z ]box%',SrcAddress)+1,0,' ')
where patindex('%[^a-np-z ]box%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=replace(SrcAddress,' 0',' ')
where patindex('% 0[1-9]%',SrcAddress)>0--

--best to check these first for now
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where left(SrcAddress,2)='bx'--

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=replace(replace(SrcAddress,'BX','PO Box '),'  ',' ')
where left(SrcAddress,2)='bx'--

--and these
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where left(SrcAddress,3) in ('PO ','P.O','P O','PO.')
and charindex('box',SrcAddress)=0

select 'PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress)),* from EAXXX_ClientNameSourceYYYYMMDD_maddress
where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
and charindex('drawer',SrcAddress)=0

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress='PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress))
	where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
	and charindex('drawer',SrcAddress)=0--

--and these as well:
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where charindex('bx',SrcAddress)>0

update EAXXX_ClientNameSourceYYYYMMDD_maddress set SrcAddress=replace(replace(SrcAddress,'BX',' Box '),'  ',' ')
where charindex('bx',SrcAddress)>0--
----
--on .186
use staging1

SELECT * INTO Staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_maddress--
FROM OPENQUERY	( [10.10.0.210], 'SELECT * from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD_maddress')

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where srccity is null

alter table EAXXX_ClientNameSourceYYYYMMDD_maddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_maddress primary key clustered (k1)

usp_StandardizeAddresses EAXXX_ClientNameSourceYYYYMMDD_maddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_maddress

usp_EAPostMelissaFixing EAXXX_ClientNameSourceYYYYMMDD_maddress
----------
--on .210(or whatever the targer server)
drop table EAXXX_ClientNameSourceYYYYMMDD_maddress

SELECT * INTO EAXXX_ClientNameSourceYYYYMMDD_maddress--
FROM OPENQUERY	( stagingb, 'SELECT * from staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_maddress')

select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_maddress

--add back your original columns in case then length was earlier truncated, make sure to not update an existing standardized address field even if that's the name from the original file
--City vs OriginalCity, etc
alter table EAXXX_ClientNameSourceYYYYMMDD_maddress add [mAddress1] varchar(150), [mAddress2] varchar(150), [mAddress3] varchar(150), [mCity] varchar(150), [mState] varchar(150),
[mZip] varchar(150), [mzip_plus_4] varchar(150), [mCountry] varchar(150), mCountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD_maddress set [mAddress1]=b.[mAddress1], [mAddress2]=b.[mAddress2], [mAddress3]=b.[mAddress3], [mCity]=b.[mCity], [mState]=b.[mState],
[mZip]=b.[mZip],[mzip_plus_4]=b.[mzip_plus_4],[mCountry]=b.[mCountry],mCountryCode=b.mCountryCode
from EAXXX_ClientNameSourceYYYYMMDD_maddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1
---------
--back on .186
use staging1

drop table EAXXX_ClientNameSourceYYYYMMDD_maddress
---------------------------------------------------
--Working Addresses
--
select [waddress1], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [waddress1]
order by [waddress1]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where waddress1 is not null

--usually apts
select [waddress2], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [waddress2]
order by [waddress2]

--combine them
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
--where waddress1 is not null and waddress2 is not null
where waddress1 is null and waddress2 is not null--00

--this one had data
select [wAddress3], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [wAddress3]
order by [wAddress3]

--
select [wCity], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [wCity]
order by [wCity]

--
select [wState], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [wState]
order by [wState]

--this part will never be perfect, feel free to adapt the zip queries below to suit your needs
select [wZip], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [wZip]
order by [wZip]

--all over the place
select len([wZip]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([wZip])
order by len([wZip])

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len([wZip]) not in('10','5')

--IF YOU'RE GIVEN A COMBINED ZIP5 AND ZIP4 COLUMN
select wzip_plus_4, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by wzip_plus_4
order by wzip_plus_4

--all over the place
select len(wzip_plus_4), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len(wzip_plus_4)
order by len(wzip_plus_4)

--IF THEY DON'T HAVE A COUNTRY WE HAVE TO ASSUME IT'S ALL US UNLESS OTHERWISE NOTED
select [wCountry], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [wCountry]
order by [wCountry]

--this is where you grab the country code
select * from van_main_copy.dbo.isocountries

alter table EAXXX_ClientNameSourceYYYYMMDD add wCountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD set wCountryCode=b.countrycode
from EAXXX_ClientNameSourceYYYYMMDD a, van_main_copy.dbo.isocountries b
where a.[wCountry]=b.countryname

--look to see if any of the countries need to manually be matched
select [wCountry], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where wCountryCode is null
group by [wCountry]
order by [wCountry]

--intentionally leaving null countries w/ a null mcountrycode; fill in and add as necessary
update EAXXX_ClientNameSourceYYYYMMDD set wCountryCode=case 
when [wCountry]='' then ''
when [wCountry]='' then ''
when [wCountry]='' then ''
else wCountryCode end

select top 1000 *--select count(*)--4358
from EAXXX_ClientNameSourceYYYYMMDD
where [wCity] is null and [wZip] is null and [wState] is null--
and (waddress1 is not null or waddress2 is not null)

--Because it's an EA/MC db, take whatever address parts you can
select --1000
k1,
SrcAddress=nullif(nullif(nullif(ltrim(rtrim(IsNull([waddress1],'') + ' ' +IsNull([waddress2],'')+ ' ' +IsNull([wAddress3],''))),'   '),' '),''),
SrcCity=[wCity],
SrcState=[wState],
SrcZip=case when len([wZip])=9 and right([wZip],4)!='0000' then left([wZip],5)+'-'+right([wZip],4)
    when len([wZip])=10 and right([wZip],4)!='0000' and left(right([wZip],5),1) = '-' then [wZip]
    when len([wZip])=4 AND wstate IN ('ME', 'NH', 'VT', 'CT', 'RI', 'MA', 'NJ', 'NY') THEN '0'+[wZip]
    when len([wZip])=3 AND wstate IN ('PR','VI','AE') THEN '00'+[wZip]
    when len([wZip])=4 AND wstate IS NULL THEN '0'+[wZip]
	else left([wZip],5) END
--SrcZip=case when len(dbo.numericonly(wzip_plus_4))=5 and [wzip] is null then dbo.numericonly(wzip_plus_4)
--			when len(dbo.numericonly(wzip_plus_4))=4 and len(dbo.numericonly([wzip]))=4 then '0'+dbo.numericonly([wzip])+'-'+dbo.numericonly(wzip_plus_4)
--			when len(dbo.numericonly(wzip_plus_4))=4 and len(dbo.numericonly([wzip]))=5 then left(dbo.numericonly([wzip]),5)+'-'+dbo.numericonly(wzip_plus_4)
--			when len(dbo.numericonly([wzip]))=9 and right(dbo.numericonly([wzip]),4)!='0000' then left(dbo.numericonly([wzip]),5)+'-'+right(dbo.numericonly([wzip]),4)
--			when len(dbo.numericonly([wzip]))=4 and len([wzip])=4 then '0'+[wzip]
--			when len(dbo.numericonly([wzip]))=5 and len([wzip])=5 then [wzip]
--			when len(dbo.numericonly([wzip]))>5 then left([wzip],5)--this will weed out the postal codes
-- 				else [wzip] END
into EAXXX_ClientNameSourceYYYYMMDD_waddress--
from EAXXX_ClientNameSourceYYYYMMDD
where isnull(cast(wCountryCode as varchar(2)),'US')='US'
and ([wCity] is not null or [wZip] is not null or [wState] is not null or waddress1 is not null or waddress2 is not null or waddress3 is not null)
order by [wCity]

--drop table EAXXX_ClientNameSourceYYYYMMDD_waddress

--
select len(srczip), count(*) from EAXXX_ClientNameSourceYYYYMMDD_waddress
group by len(srczip)
order by len(srczip)

--looks good to me
select SrcAddress, count(*) from EAXXX_ClientNameSourceYYYYMMDD_waddress
group by SrcAddress
order by SrcAddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_waddress
where srcaddress is null

--dupe addresses
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_waddress where SrcAddress is not null group by SrcAddress having count(*)>1)
order by k1

select count(*) from EAXXX_ClientNameSourceYYYYMMDD_waddress where SrcAddress in
(select SrcAddress from EAXXX_ClientNameSourceYYYYMMDD_waddress where SrcAddress is not null
group by SrcAddress having count(*)>1)--

--messy file, do checks
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where patindex('%HC[0-9]%',SrcAddress)>0 or patindex('%HCR[0-9]%',SrcAddress)>0
or patindex('%RR[0-9]%',SrcAddress)>0 or patindex('%box[0-9]%',SrcAddress)>0 or patindex('%[^a-np-z ]box%',SrcAddress)>0 or charindex('bx',SrcAddress)>0
or  patindex('% 0[1-9]%',SrcAddress)>0
or (left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0)

--!!NEED TO DO THIS!!
update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=stuff(SrcAddress,patindex('%HC[0-9]%',SrcAddress)+2,0,' ')
where patindex('%HC[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=stuff(SrcAddress,patindex('%HCR[0-9]%',SrcAddress)+3,0,' ')
where patindex('%HCR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=stuff(SrcAddress,patindex('%RR[0-9]%',SrcAddress)+2,0,' ')
where patindex('%RR[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=stuff(SrcAddress,patindex('%box[0-9]%',SrcAddress)+3,0,' ')
where patindex('%box[0-9]%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=stuff(SrcAddress,patindex('%[^a-np-z ]box%',SrcAddress)+1,0,' ')
where patindex('%[^a-np-z ]box%',SrcAddress)>0--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=replace(SrcAddress,' 0',' ')
where patindex('% 0[1-9]%',SrcAddress)>0--

--best to check these first for now
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where left(SrcAddress,2)='bx'--

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=replace(replace(SrcAddress,'BX','PO Box '),'  ',' ')
where left(SrcAddress,2)='bx'--

--and these
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where left(SrcAddress,3) in ('PO ','P.O','P O','PO.')
and charindex('box',SrcAddress)=0

select 'PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress)),* from EAXXX_ClientNameSourceYYYYMMDD_waddress
where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
and charindex('drawer',SrcAddress)=0

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress='PO Box '+substring(SrcAddress,patindex('%[0-9]%',SrcAddress),len(SrcAddress))
	where left(SrcAddress,3) in ('PO ','P.O','P O','PO.') and charindex('box',SrcAddress)=0 and patindex('%[0-9]%',SrcAddress)>0
	and charindex('drawer',SrcAddress)=0--

--and these as well:
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where charindex('bx',SrcAddress)>0

update EAXXX_ClientNameSourceYYYYMMDD_waddress set SrcAddress=replace(replace(SrcAddress,'BX',' Box '),'  ',' ')
where charindex('bx',SrcAddress)>0--
----
--on .186
use staging1

SELECT * INTO Staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_waddress--
FROM OPENQUERY	( [10.10.0.210], 'SELECT * from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD_waddress')

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where srccity is null

alter table EAXXX_ClientNameSourceYYYYMMDD_waddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_waddress primary key clustered (k1)

usp_StandardizeAddresses EAXXX_ClientNameSourceYYYYMMDD_waddress

--
select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_waddress

usp_EAPostMelissaFixing EAXXX_ClientNameSourceYYYYMMDD_waddress
-----
--on .210(or whatever the targer server)
use staging

drop table EAXXX_ClientNameSourceYYYYMMDD_waddress

SELECT * INTO EAXXX_ClientNameSourceYYYYMMDD_waddress--
FROM OPENQUERY	( stagingb, 'SELECT * from staging1.dbo.EAXXX_ClientNameSourceYYYYMMDD_waddress')

select count(*)--select top 1000 *
from EAXXX_ClientNameSourceYYYYMMDD_waddress

--add back your original columns in case then length was earlier truncated, make sure to not update an existing standardized address field even if that's the name from the original file
--City vs OriginalCity, etc
alter table EAXXX_ClientNameSourceYYYYMMDD_waddress add [waddress1] varchar(150), [waddress2] varchar(150), [wAddress3] varchar(150), [wCity] varchar(150), [wState] varchar(150),
[wZip] varchar(150), [wzip_plus_4] varchar(150), [wCountry] varchar(150), wCountryCode varchar(2)

update EAXXX_ClientNameSourceYYYYMMDD_waddress set [waddress1]=b.[waddress1], [waddress2]=b.[waddress2], [wAddress3]=b.[wAddress3], [wCity]=b.[wCity], [wState]=b.[wState],
[wZip]=b.[wZip],[wzip_plus_4]=b.[wzip_plus_4],[wCountry]=b.[wCountry],wCountryCode=b.wCountryCode
from EAXXX_ClientNameSourceYYYYMMDD_waddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1
-------
--back on .186
use staging1

drop table EAXXX_ClientNameSourceYYYYMMDD_waddress
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Phones: look mostly good

/*==================================
Home Phone
==================================*/

--Phone: will be homephone and preferred
select [Phone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where phone like '%ext%' or phone like '%x%'
group by [Phone]
order by [Phone]

--all over the place
select len([Phone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([Phone])
order by len([Phone])

select top 1000 phone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(phone)=11 and left(phone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where phone is not null--
and van_EAXXX_contacts.dbo.numericonly(phone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' ext',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' ext',phone)+4,len(phone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where phone like '% ext%'
group by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' ext',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' ext',phone)+4,len(phone)))))
order by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' ext',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' ext',phone)+4,len(phone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add Newphone varchar(50), NewphoneExt varchar(50), BadPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newphone=dbo.numericonly(ltrim(rtrim(left(phone,charindex(' ext',phone)-1)))),
NewphoneExt=dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' ext',phone)+4,len(phone)))))
where phone like '% ext%'

--this should take care of extensions
select phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' x',phone)+1,len(phone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where phone like '% x%' and newphoneext is null
group by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' x',phone)+1,len(phone)))))
order by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex(' x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' x',phone)+1,len(phone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newphone=dbo.numericonly(ltrim(rtrim(left(phone,charindex(' x',phone)-1)))),
NewphoneExt=dbo.numericonly(ltrim(rtrim(substring(phone,charindex(' x',phone)+1,len(phone)))))
where phone like '% x%' and newphoneext is null

--mashed together 'x'
select phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex('x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex('x',phone)+1,len(phone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where phone like '%x%' and NewPhoneExt is null
group by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex('x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex('x',phone)+1,len(phone)))))
order by phone, dbo.numericonly(ltrim(rtrim(left(phone,charindex('x',phone)-1)))),dbo.numericonly(ltrim(rtrim(substring(phone,charindex('x',phone)+1,len(phone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newphone=dbo.numericonly(ltrim(rtrim(left(phone,charindex('x',phone)-1)))),
NewphoneExt=dbo.numericonly(ltrim(rtrim(substring(phone,charindex('x',phone)+1,len(phone)))))
where phone like '%x%' and NewPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [Phone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (phone like '%ext%' or phone like '%x%')
and NewphoneExt is null
group by [Phone]
order by [Phone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newphone='6018452214',newphoneext='2319' where phone='601-845-2214 (extension 2319)'

select top 1000 *,phone from EAXXX_ClientNameSourceYYYYMMDD where NewphoneExt is not null 

select NewphoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newphoneext
order by newphoneext

update EAXXX_ClientNameSourceYYYYMMDD set newphoneext=null where newphoneext=''

--what's left
select len(dbo.numericonly(phone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newphone is null
group by len(dbo.numericonly(phone))
order by len(dbo.numericonly(phone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(phone),2,10),phone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(phone))=11 and left(dbo.numericonly(phone),1)=1 --and phone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newphone=substring(dbo.numericonly(phone),2,10)
where len(dbo.numericonly(phone))=11 and left(dbo.numericonly(phone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(phone),phone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(phone))=10
and newphone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newphone=dbo.numericonly(phone)
where len(dbo.numericonly(phone))=10
and newphone is null

select len(newphone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newphone)
order by len(newphone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where phone is not null and newphone is null
and len(dbo.numericonly(phone))=11

select len(phone), len(dbo.numericonly(phone)) from EAXXX_ClientNameSourceYYYYMMDD
where phone is not null and newphone is null
group by len(phone), len(dbo.numericonly(phone))
order by len(phone), len(dbo.numericonly(phone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badphonenote=phone where phone is not null and newphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badphonenote=phone,newphone=null--
where newphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

/*==================================
Work Phone
==================================*/

--Phone: will be workphone
select [WorkPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone like '%ext%' or WorkPhone like '%x%'
group by [WorkPhone]
order by [WorkPhone]

--all over the place
select len([WorkPhone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([WorkPhone])
order by len([WorkPhone])

select top 1000 WorkPhone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(WorkPhone)=11 and left(WorkPhone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone is not null--
and van_EAXXX_contacts.dbo.numericonly(WorkPhone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' ext',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' ext',WorkPhone)+4,len(WorkPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone like '% ext%'
group by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' ext',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' ext',WorkPhone)+4,len(WorkPhone)))))
order by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' ext',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' ext',WorkPhone)+4,len(WorkPhone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add NewWorkPhone varchar(50), NewWorkPhoneExt varchar(50), BadWorkPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone=dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' ext',WorkPhone)-1)))),
NewWorkPhoneExt=dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' ext',WorkPhone)+4,len(WorkPhone)))))
where WorkPhone like '% ext%'

--this should take care of extensions
select WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' x',WorkPhone)+1,len(WorkPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone like '% x%' and newWorkPhoneext is null
group by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' x',WorkPhone)+1,len(WorkPhone)))))
order by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' x',WorkPhone)+1,len(WorkPhone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone=dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex(' x',WorkPhone)-1)))),
NewWorkPhoneExt=dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex(' x',WorkPhone)+1,len(WorkPhone)))))
where WorkPhone like '% x%' and newWorkPhoneext is null

--mashed together 'x'
select WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex('x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex('x',WorkPhone)+1,len(WorkPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone like '%x%' and NewWorkPhoneExt is null
group by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex('x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex('x',WorkPhone)+1,len(WorkPhone)))))
order by WorkPhone, dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex('x',WorkPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex('x',WorkPhone)+1,len(WorkPhone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone=dbo.numericonly(ltrim(rtrim(left(WorkPhone,charindex('x',WorkPhone)-1)))),
NewWorkPhoneExt=dbo.numericonly(ltrim(rtrim(substring(WorkPhone,charindex('x',WorkPhone)+1,len(WorkPhone)))))
where WorkPhone like '%x%' and NewWorkPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [WorkPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (WorkPhone like '%ext%' or WorkPhone like '%x%')
and NewWorkPhoneExt is null
group by [WorkPhone]
order by [WorkPhone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone='6018452214',newWorkPhoneext='2319' where WorkPhone='601-845-2214 (extension 2319)'

select top 1000 *,WorkPhone from EAXXX_ClientNameSourceYYYYMMDD where NewWorkPhoneExt is not null 

select NewWorkPhoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newWorkPhoneext
order by newWorkPhoneext

update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhoneext=null where newWorkPhoneext=''

--what's left
select len(dbo.numericonly(WorkPhone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newWorkPhone is null
group by len(dbo.numericonly(WorkPhone))
order by len(dbo.numericonly(WorkPhone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(WorkPhone),2,10),WorkPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(WorkPhone))=11 and left(dbo.numericonly(WorkPhone),1)=1 --and WorkPhone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone=substring(dbo.numericonly(WorkPhone),2,10)
where len(dbo.numericonly(WorkPhone))=11 and left(dbo.numericonly(WorkPhone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(WorkPhone),WorkPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(WorkPhone))=10
and newWorkPhone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newWorkPhone=dbo.numericonly(WorkPhone)
where len(dbo.numericonly(WorkPhone))=10
and newWorkPhone is null

select len(newWorkPhone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newWorkPhone)
order by len(newWorkPhone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where WorkPhone is not null and newWorkPhone is null
and len(dbo.numericonly(WorkPhone))=11

select len(WorkPhone), len(dbo.numericonly(WorkPhone)) from EAXXX_ClientNameSourceYYYYMMDD
where WorkPhone is not null and newWorkPhone is null
group by len(WorkPhone), len(dbo.numericonly(WorkPhone))
order by len(WorkPhone), len(dbo.numericonly(WorkPhone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badworkphonenote=workphone where workphone is not null and newworkphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badworkphonenote=workphone,newworkphone=null--
where newworkphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

/*==================================
Cell Phone
==================================*/

--Phone: will be Cellphone
select [CellPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone like '%ext%' or CellPhone like '%x%'
group by [CellPhone]
order by [CellPhone]

--all over the place
select len([CellPhone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([CellPhone])
order by len([CellPhone])

select top 1000 CellPhone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(CellPhone)=11 and left(CellPhone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone is not null--
and van_EAXXX_contacts.dbo.numericonly(CellPhone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' ext',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' ext',CellPhone)+4,len(CellPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone like '% ext%'
group by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' ext',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' ext',CellPhone)+4,len(CellPhone)))))
order by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' ext',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' ext',CellPhone)+4,len(CellPhone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add NewCellPhone varchar(50), NewCellPhoneExt varchar(50), BadCellPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone=dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' ext',CellPhone)-1)))),
NewCellPhoneExt=dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' ext',CellPhone)+4,len(CellPhone)))))
where CellPhone like '% ext%'

--this should take care of extensions
select CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' x',CellPhone)+1,len(CellPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone like '% x%' and newCellPhoneext is null
group by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' x',CellPhone)+1,len(CellPhone)))))
order by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' x',CellPhone)+1,len(CellPhone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone=dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex(' x',CellPhone)-1)))),
NewCellPhoneExt=dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex(' x',CellPhone)+1,len(CellPhone)))))
where CellPhone like '% x%' and newCellPhoneext is null

--mashed together 'x'
select CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex('x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex('x',CellPhone)+1,len(CellPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone like '%x%' and NewCellPhoneExt is null
group by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex('x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex('x',CellPhone)+1,len(CellPhone)))))
order by CellPhone, dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex('x',CellPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex('x',CellPhone)+1,len(CellPhone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone=dbo.numericonly(ltrim(rtrim(left(CellPhone,charindex('x',CellPhone)-1)))),
NewCellPhoneExt=dbo.numericonly(ltrim(rtrim(substring(CellPhone,charindex('x',CellPhone)+1,len(CellPhone)))))
where CellPhone like '%x%' and NewCellPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [CellPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (CellPhone like '%ext%' or CellPhone like '%x%')
and NewCellPhoneExt is null
group by [CellPhone]
order by [CellPhone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone='6018452214',newCellPhoneext='2319' where CellPhone='601-845-2214 (extension 2319)'

select top 1000 *,CellPhone from EAXXX_ClientNameSourceYYYYMMDD where NewCellPhoneExt is not null 

select NewCellPhoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newCellPhoneext
order by newCellPhoneext

update EAXXX_ClientNameSourceYYYYMMDD set newCellPhoneext=null where newCellPhoneext=''

--what's left
select len(dbo.numericonly(CellPhone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newCellPhone is null
group by len(dbo.numericonly(CellPhone))
order by len(dbo.numericonly(CellPhone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(CellPhone),2,10),CellPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(CellPhone))=11 and left(dbo.numericonly(CellPhone),1)=1 --and CellPhone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone=substring(dbo.numericonly(CellPhone),2,10)
where len(dbo.numericonly(CellPhone))=11 and left(dbo.numericonly(CellPhone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(CellPhone),CellPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(CellPhone))=10
and newCellPhone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newCellPhone=dbo.numericonly(CellPhone)
where len(dbo.numericonly(CellPhone))=10
and newCellPhone is null

select len(newCellPhone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newCellPhone)
order by len(newCellPhone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where CellPhone is not null and newCellPhone is null
and len(dbo.numericonly(CellPhone))=11

select len(CellPhone), len(dbo.numericonly(CellPhone)) from EAXXX_ClientNameSourceYYYYMMDD
where CellPhone is not null and newCellPhone is null
group by len(CellPhone), len(dbo.numericonly(CellPhone))
order by len(CellPhone), len(dbo.numericonly(CellPhone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badCellphonenote=Cellphone where Cellphone is not null and newCellphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badCellphonenote=Cellphone,newCellphone=null--
where newCellphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

/*==================================
Fax Phone
==================================*/

--Phone: will be Faxphone
select [FaxPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone like '%ext%' or FaxPhone like '%x%'
group by [FaxPhone]
order by [FaxPhone]

--all over the place
select len([FaxPhone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([FaxPhone])
order by len([FaxPhone])

select top 1000 FaxPhone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(FaxPhone)=11 and left(FaxPhone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone is not null--
and van_EAXXX_contacts.dbo.numericonly(FaxPhone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' ext',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' ext',FaxPhone)+4,len(FaxPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone like '% ext%'
group by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' ext',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' ext',FaxPhone)+4,len(FaxPhone)))))
order by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' ext',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' ext',FaxPhone)+4,len(FaxPhone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add NewFaxPhone varchar(50), NewFaxPhoneExt varchar(50), BadFaxPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone=dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' ext',FaxPhone)-1)))),
NewFaxPhoneExt=dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' ext',FaxPhone)+4,len(FaxPhone)))))
where FaxPhone like '% ext%'

--this should take care of extensions
select FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' x',FaxPhone)+1,len(FaxPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone like '% x%' and newFaxPhoneext is null
group by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' x',FaxPhone)+1,len(FaxPhone)))))
order by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' x',FaxPhone)+1,len(FaxPhone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone=dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex(' x',FaxPhone)-1)))),
NewFaxPhoneExt=dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex(' x',FaxPhone)+1,len(FaxPhone)))))
where FaxPhone like '% x%' and newFaxPhoneext is null

--mashed together 'x'
select FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex('x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex('x',FaxPhone)+1,len(FaxPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone like '%x%' and NewFaxPhoneExt is null
group by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex('x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex('x',FaxPhone)+1,len(FaxPhone)))))
order by FaxPhone, dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex('x',FaxPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex('x',FaxPhone)+1,len(FaxPhone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone=dbo.numericonly(ltrim(rtrim(left(FaxPhone,charindex('x',FaxPhone)-1)))),
NewFaxPhoneExt=dbo.numericonly(ltrim(rtrim(substring(FaxPhone,charindex('x',FaxPhone)+1,len(FaxPhone)))))
where FaxPhone like '%x%' and NewFaxPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [FaxPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (FaxPhone like '%ext%' or FaxPhone like '%x%')
and NewFaxPhoneExt is null
group by [FaxPhone]
order by [FaxPhone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone='6018452214',newFaxPhoneext='2319' where FaxPhone='601-845-2214 (extension 2319)'

select top 1000 *,FaxPhone from EAXXX_ClientNameSourceYYYYMMDD where NewFaxPhoneExt is not null 

select NewFaxPhoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newFaxPhoneext
order by newFaxPhoneext

update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhoneext=null where newFaxPhoneext=''

--what's left
select len(dbo.numericonly(FaxPhone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newFaxPhone is null
group by len(dbo.numericonly(FaxPhone))
order by len(dbo.numericonly(FaxPhone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(FaxPhone),2,10),FaxPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(FaxPhone))=11 and left(dbo.numericonly(FaxPhone),1)=1 --and FaxPhone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone=substring(dbo.numericonly(FaxPhone),2,10)
where len(dbo.numericonly(FaxPhone))=11 and left(dbo.numericonly(FaxPhone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(FaxPhone),FaxPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(FaxPhone))=10
and newFaxPhone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newFaxPhone=dbo.numericonly(FaxPhone)
where len(dbo.numericonly(FaxPhone))=10
and newFaxPhone is null

select len(newFaxPhone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newFaxPhone)
order by len(newFaxPhone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where FaxPhone is not null and newFaxPhone is null
and len(dbo.numericonly(FaxPhone))=11

select len(FaxPhone), len(dbo.numericonly(FaxPhone)) from EAXXX_ClientNameSourceYYYYMMDD
where FaxPhone is not null and newFaxPhone is null
group by len(FaxPhone), len(dbo.numericonly(FaxPhone))
order by len(FaxPhone), len(dbo.numericonly(FaxPhone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badFaxphonenote=Faxphone where Faxphone is not null and newFaxphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badFaxphonenote=Faxphone,newFaxphone=null--
where newFaxphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

/*==================================
Other Phone
==================================*/

--Phone: will be Otherphone
select [OtherPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone like '%ext%' or OtherPhone like '%x%'
group by [OtherPhone]
order by [OtherPhone]

--all over the place
select len([OtherPhone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([OtherPhone])
order by len([OtherPhone])

select top 1000 OtherPhone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(OtherPhone)=11 and left(OtherPhone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone is not null--
and van_EAXXX_contacts.dbo.numericonly(OtherPhone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' ext',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' ext',OtherPhone)+4,len(OtherPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone like '% ext%'
group by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' ext',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' ext',OtherPhone)+4,len(OtherPhone)))))
order by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' ext',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' ext',OtherPhone)+4,len(OtherPhone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add NewOtherPhone varchar(50), NewOtherPhoneExt varchar(50), BadOtherPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone=dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' ext',OtherPhone)-1)))),
NewOtherPhoneExt=dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' ext',OtherPhone)+4,len(OtherPhone)))))
where OtherPhone like '% ext%'

--this should take care of extensions
select OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' x',OtherPhone)+1,len(OtherPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone like '% x%' and newOtherPhoneext is null
group by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' x',OtherPhone)+1,len(OtherPhone)))))
order by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' x',OtherPhone)+1,len(OtherPhone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone=dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex(' x',OtherPhone)-1)))),
NewOtherPhoneExt=dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex(' x',OtherPhone)+1,len(OtherPhone)))))
where OtherPhone like '% x%' and newOtherPhoneext is null

--mashed together 'x'
select OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex('x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex('x',OtherPhone)+1,len(OtherPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone like '%x%' and NewOtherPhoneExt is null
group by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex('x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex('x',OtherPhone)+1,len(OtherPhone)))))
order by OtherPhone, dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex('x',OtherPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex('x',OtherPhone)+1,len(OtherPhone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone=dbo.numericonly(ltrim(rtrim(left(OtherPhone,charindex('x',OtherPhone)-1)))),
NewOtherPhoneExt=dbo.numericonly(ltrim(rtrim(substring(OtherPhone,charindex('x',OtherPhone)+1,len(OtherPhone)))))
where OtherPhone like '%x%' and NewOtherPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [OtherPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (OtherPhone like '%ext%' or OtherPhone like '%x%')
and NewOtherPhoneExt is null
group by [OtherPhone]
order by [OtherPhone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone='6018452214',newOtherPhoneext='2319' where OtherPhone='601-845-2214 (extension 2319)'

select top 1000 *,OtherPhone from EAXXX_ClientNameSourceYYYYMMDD where NewOtherPhoneExt is not null 

select NewOtherPhoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newOtherPhoneext
order by newOtherPhoneext

update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhoneext=null where newOtherPhoneext=''

--what's left
select len(dbo.numericonly(OtherPhone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newOtherPhone is null
group by len(dbo.numericonly(OtherPhone))
order by len(dbo.numericonly(OtherPhone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(OtherPhone),2,10),OtherPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(OtherPhone))=11 and left(dbo.numericonly(OtherPhone),1)=1 --and OtherPhone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone=substring(dbo.numericonly(OtherPhone),2,10)
where len(dbo.numericonly(OtherPhone))=11 and left(dbo.numericonly(OtherPhone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(OtherPhone),OtherPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(OtherPhone))=10
and newOtherPhone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newOtherPhone=dbo.numericonly(OtherPhone)
where len(dbo.numericonly(OtherPhone))=10
and newOtherPhone is null

select len(newOtherPhone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newOtherPhone)
order by len(newOtherPhone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where OtherPhone is not null and newOtherPhone is null
and len(dbo.numericonly(OtherPhone))=11

select len(OtherPhone), len(dbo.numericonly(OtherPhone)) from EAXXX_ClientNameSourceYYYYMMDD
where OtherPhone is not null and newOtherPhone is null
group by len(OtherPhone), len(dbo.numericonly(OtherPhone))
order by len(OtherPhone), len(dbo.numericonly(OtherPhone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badOtherphonenote=Otherphone where Otherphone is not null and newOtherphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badOtherphonenote=Otherphone,newOtherphone=null--
where newOtherphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

/*==================================
Main Phone
==================================*/

--Phone: will be Mainphone
select [MainPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone like '%ext%' or MainPhone like '%x%'
group by [MainPhone]
order by [MainPhone]

--all over the place
select len([MainPhone]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([MainPhone])
order by len([MainPhone])

select top 1000 MainPhone,*--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where len(MainPhone)=11 and left(MainPhone,1)='1'

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone is not null--
and van_EAXXX_contacts.dbo.numericonly(MainPhone) not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]')--

--First we separate out the extensions
select MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' ext',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' ext',MainPhone)+4,len(MainPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone like '% ext%'
group by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' ext',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' ext',MainPhone)+4,len(MainPhone)))))
order by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' ext',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' ext',MainPhone)+4,len(MainPhone)))))

--I usually just add "New" to whatever the phone columns are currently labeled; if it's labeled "phone" then "NewPhone/NewPhoneExt" for my columns, if "homephone"
--then "NewHomePhone/NewHomePhoneExt"; same sort of logic applies to the "BadPhone" Note fields
alter table EAXXX_ClientNameSourceYYYYMMDD add NewMainPhone varchar(50), NewMainPhoneExt varchar(50), BadMainPhoneNote varchar(100)

update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone=dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' ext',MainPhone)-1)))),
NewMainPhoneExt=dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' ext',MainPhone)+4,len(MainPhone)))))
where MainPhone like '% ext%'

--this should take care of extensions
select MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' x',MainPhone)+1,len(MainPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone like '% x%' and newMainPhoneext is null
group by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' x',MainPhone)+1,len(MainPhone)))))
order by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' x',MainPhone)+1,len(MainPhone)))))

update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone=dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex(' x',MainPhone)-1)))),
NewMainPhoneExt=dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex(' x',MainPhone)+1,len(MainPhone)))))
where MainPhone like '% x%' and newMainPhoneext is null

--mashed together 'x'
select MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex('x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex('x',MainPhone)+1,len(MainPhone)))))
, count(*) from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone like '%x%' and NewMainPhoneExt is null
group by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex('x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex('x',MainPhone)+1,len(MainPhone)))))
order by MainPhone, dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex('x',MainPhone)-1)))),dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex('x',MainPhone)+1,len(MainPhone)))))

--
update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone=dbo.numericonly(ltrim(rtrim(left(MainPhone,charindex('x',MainPhone)-1)))),
NewMainPhoneExt=dbo.numericonly(ltrim(rtrim(substring(MainPhone,charindex('x',MainPhone)+1,len(MainPhone)))))
where MainPhone like '%x%' and NewMainPhoneext is null

--let's look at whatever's left, maybe do one off fixes
select [MainPhone], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where (MainPhone like '%ext%' or MainPhone like '%x%')
and NewMainPhoneExt is null
group by [MainPhone]
order by [MainPhone]

--an example
update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone='6018452214',newMainPhoneext='2319' where MainPhone='601-845-2214 (extension 2319)'

select top 1000 *,MainPhone from EAXXX_ClientNameSourceYYYYMMDD where NewMainPhoneExt is not null 

select NewMainPhoneExt, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by newMainPhoneext
order by newMainPhoneext

update EAXXX_ClientNameSourceYYYYMMDD set newMainPhoneext=null where newMainPhoneext=''

--what's left
select len(dbo.numericonly(MainPhone)) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
where newMainPhone is null
group by len(dbo.numericonly(MainPhone))
order by len(dbo.numericonly(MainPhone))

--all 11 lengths
select top 1000 substring(dbo.numericonly(MainPhone),2,10),MainPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(MainPhone))=11 and left(dbo.numericonly(MainPhone),1)=1 --and MainPhone not like '%(%)%'

--
update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone=substring(dbo.numericonly(MainPhone),2,10)
where len(dbo.numericonly(MainPhone))=11 and left(dbo.numericonly(MainPhone),1)=1

--all 10 lengths
select top 1000 dbo.numericonly(MainPhone),MainPhone,* 
from EAXXX_ClientNameSourceYYYYMMDD where len(dbo.numericonly(MainPhone))=10
and newMainPhone is null

--
update EAXXX_ClientNameSourceYYYYMMDD set newMainPhone=dbo.numericonly(MainPhone)
where len(dbo.numericonly(MainPhone))=10
and newMainPhone is null

select len(newMainPhone) ,count(*) as thecount from EAXXX_ClientNameSourceYYYYMMDD
group by len(newMainPhone)
order by len(newMainPhone)

--nothing else i can do
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where MainPhone is not null and newMainPhone is null
and len(dbo.numericonly(MainPhone))=11

select len(MainPhone), len(dbo.numericonly(MainPhone)) from EAXXX_ClientNameSourceYYYYMMDD
where MainPhone is not null and newMainPhone is null
group by len(MainPhone), len(dbo.numericonly(MainPhone))
order by len(MainPhone), len(dbo.numericonly(MainPhone))

--
update EAXXX_ClientNameSourceYYYYMMDD set badMainphonenote=Mainphone where Mainphone is not null and newMainphone is null

--moving the original phone into the badphone note column if it doesn't fulfill our phone requirements
update EAXXX_ClientNameSourceYYYYMMDD set badMainphonenote=Mainphone,newMainphone=null--
where newMainphone not LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') 

--------------------------------------------------------------------------------------------------------------------------------------------------------------------
--EMAILS
select [EMail], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [EMail]
order by [EMail]

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD where email is not null

--
select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where email is not null
and email is not null and charindex('@',email)>0 and charindex('.',email)>0
and charindex('..',email)=0 and charindex('.@',email)=0
and left(ltrim(email),1) not in ('@','.')
and patindex('%^a-z0-9_.+@-%',ltrim(rtrim(email)))=0
and CHARINDEX('.',REVERSE(LTRIM(RTRIM(email))))>2 
and CHARINDEX('.',REVERSE(LTRIM(RTRIM(email))))<6
and charindex('@',email,charindex('@',email)+1)=0
and CHARINDEX('.',email,CHARINDEX('@',email)) - CHARINDEX('@',email)>1
---------------------------------------------------------------------------------------------------------------------------
--NAMES: WE'RE NOT GOING TO DO ANY CLEANUP

--Person Names
--meh, usually ignore
select [Title], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Title]
order by [Title]

--
select [First], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where [First] like '% and%' or [First] like '%&%'
group by [First]
order by [First]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where [First] like '% and%' or [First] like '%&%'

select max(len([first])) from EAXXX_ClientNameSourceYYYYMMDD

--
select [Middle], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Middle]
order by [Middle]

--
select [Last], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where [Last] like '% and%' or [Last] like '%&%'
group by [Last]
order by [Last]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where [Last] like '% and%' or [Last] like '%&%'

select max(len([Last])) from EAXXX_ClientNameSourceYYYYMMDD

select [Suffix], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Suffix]
order by [Suffix]
--USUALLY IGNORE A 2ND SET OF PERSON NAMES
--------
--Organization Names
--How are we determining what records are Orgs?
select OrganizationName, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by OrganizationName
order by OrganizationName

--as long as it's not longer than 200 characters, we're good
select max(len(organizationname)) from EAXXX_ClientNameSourceYYYYMMDD

--If you only have one columns w/ OrganizationName then use it for both OrganiztionContactOfficialName and OrganizationContactCommonName
select OrganizationContactCommonName, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by OrganizationContactCommonName
order by OrganizationContactCommonName

--as long as it's not longer than 200 characters, we're good
select max(len(OrganizationContactCommonName)) from EAXXX_ClientNameSourceYYYYMMDD

select * from van_main_copy.dbo.contactmodes

--later queries rely on this flag so no need no matter what
alter table EAXXX_ClientNameSourceYYYYMMDD add ContactModeID tinyint

--or however you're determining what's an org
update EAXXX_ClientNameSourceYYYYMMDD set ContactModeID=case when organizationname is not NULL then 2 else 1 end

--You should never have records that have Org Contact Mode and Person Names, and vice versa
select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where contactmodeid=2 and ([Title] is not null or [First] is not null or [Middle] is not null or [Last] is not null or [Suffix] is not null)

select top 1000 *--select count(*)
from EAXXX_ClientNameSourceYYYYMMDD
where contactmodeid=1 and (OrganizationName is not null or OrganizationContactCommonName is not null)
------------------------------------------------------------------------------------------------------------------------------------------------------
--let's check all the other columns

--SALUTATIONS
select top 1000 * from van_eaoo1_contacts.dbo.contactssalutations

select [Envelope1], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Envelope1]
order by [Envelope1]

select [Envelope2], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Envelope2]
order by [Envelope2]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where envelope2 is not null

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
--where envelope1 is null and envelope2 is not null--00
where envelope1 is not null and envelope2 is not null--3, combine these

--is there a real difference betwen this and envelope1?
select [Salutation], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Salutation]
order by [Salutation]

--in this scenario, Salutation will equal Envelope1
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where salutation is null and (envelope1 is not null or envelope2 is not null)

--what about? i think i ignore it bc then it will default to the actual name columns
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where envelope1 is null and envelope2 is null and salutation is not null
-----
--ContactsAdditionalContactInformation
select top 1000 * from van_EAXXX_contacts.dbo.ContactsAdditionalContactInformation

--Website
select [Website], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Website]
order by [Website]

--Nickname
select [Nickname], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Nickname]
order by [Nickname]
----------
--NOTES AND NOTE CATEGORIES
select top 1000 * from van_EAXXX_contacts.dbo.contactsnotes(nolock)
select top 1000 * from van_EAXXX_contacts.dbo.notecategories(nolock)

--Notes/Note Category
select [Mitzvah Date], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Mitzvah Date]
order by [Mitzvah Date]

--usually notes of some sort
select [ContactComments], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [ContactComments]
order by [ContactComments]

--
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where contactcomments is not null

--
select len([ContactComments]), count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by len([ContactComments])
order by len([ContactComments])
------------------------------------------
--THINGS THAT ACTUALLY HAVE A SPECIFIC SPOT
--DOB
select [Birthdate], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where isdate(birthdate)=0
group by [Birthdate]
order by [Birthdate]

--
select [Birthdate], count(*) from EAXXX_ClientNameSourceYYYYMMDD
where isdate(birthdate)=1
group by [Birthdate]
order by [Birthdate]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where birthdate is not null
-----------------------------------------------------------------------------------------------------------------------------------------------------
--EmployerName and OccupationName
select top 1000 * from van_EAXXX_contacts.dbo.contacts(nolock)
where employername is not null and occupationname is not null

--EmployerName
--Is this the same as the Org? Not really
select [Company], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Company]
order by [Company]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where company is not null

--what's the difference between this and company
select [Employer], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Employer]
order by [Employer]

select top 1000 employer,* from EAXXX_ClientNameSourceYYYYMMDD
where isnull(company,'')!=isnull(employer,'')

--will take company over employer
select top 1000 employer,* from EAXXX_ClientNameSourceYYYYMMDD
where employer is not null and company is not null--
and employer!=company--

--in this scenario, employer can fill in gaps
select top 1000 employer,* from EAXXX_ClientNameSourceYYYYMMDD
where employer is not null and company is null

--something like this
select top 1000 isnull(company,employer),employer,*
from EAXXX_ClientNameSourceYYYYMMDD
where employer is not null

--Occupation
select [Professional Title], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Professional Title]
order by [Professional Title]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where [Professional Title] is not null

select max(len(employername)) from EAXXX_ClientNameSourceYYYYMMDD--
select max(len(occupationname)) from EAXXX_ClientNameSourceYYYYMMDD--
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
--FLAGS

--Do Not Email
select [DoNotEMail], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [DoNotEMail]
order by [DoNotEMail]

--Do Not Mail
select [MailCode], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [MailCode]
order by [MailCode]

--Deceased, might want to ask if they actually give you deceased people
select [Deceased], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Deceased]
order by [Deceased]

--these are the types of flags we can deal w/
select top 1000 * from van_EAXXX_contacts.dbo.contacts(nolock)
where deceased!=0 or nocall!=0 or nowalk!=0 or nomail!=0
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD
where newphoneext is not null

alter table van_EAXXX_contacts.dbo.contacts add YourNamek1 int

--is any column length/data type wrong
select top 100 a.column_name,a.data_type,a.character_maximum_length,b.data_type,b.character_maximum_length,*
from information_schema.columns a
join VAN_EAXXX_Contacts.information_schema.columns b on a.column_name=b.column_name
where a.table_name='EAXXX_ClientNameSourceYYYYMMDD' and b.table_name='Contacts'
and (a.character_maximum_length>b.character_maximum_length or a.data_type!=b.data_type)

--this query incorporates any orgs into this insert bc it uses the ContactMode flag
insert van_EAXXX_contacts.dbo.contacts(YourNamek1,title,firstname,middlename,lastname,suffix,OrganizationContactOfficialName, OrganizationContactCommonName,ContactModeID,sex, dob,statecode,
employername,occupationname,nomail,NoEmail,active,votertypeid,committeeid,createdby,datecreated,ContactSourceID)
select a.k1 as YourNamek1,title=case when ContactModeID=1 then left(van_EAXXX_contacts.dbo.propercase(title),10) else null end,
firstname=case when ContactModeID=1 then left(van_EAXXX_contacts.dbo.propercase(firstname),20) else null end,
middlename=case when ContactModeID=1 then left(van_EAXXX_contacts.dbo.propercase(middlename),10) else null end,
lastname=case when ContactModeID=1 then left(van_EAXXX_contacts.dbo.propercase(lastname),20) else null end,suffix=case when ContactModeID=1 then van_EAXXX_contacts.dbo.propersuffix(suffix) else null end,
OrganizationContactOfficialName=case when ContactModeID=2 then van_EAXXX_contacts.dbo.propercase(OrganizationName) else null end,
OrganizationContactCommonName=case when ContactModeID=2 then van_EAXXX_contacts.dbo.propercase(OrganizationContactCommonName) else null end,ContactModeID,
sex, dob,[state],left(employername,50) as employername,left(occupationname,50) as occupationname,
nomail=case when [MailCode]='yes' then 1 else 0 end,noemail=case when [DoNotEMail]='yes' then 1 else 0 end, 'A','40',committeeid='XXXXX','##',cast(getdate() as smalldatetime), 10
from EAXXX_ClientNameSourceYYYYMMDD a left join EAXXX_ClientNameSourceYYYYMMDD_vaddress b
on a.k1=b.k1

alter table EAXXX_ClientNameSourceYYYYMMDD add vanid int

--
update EAXXX_ClientNameSourceYYYYMMDD set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD a, van_EAXXX_contacts.dbo.contacts b(nolock)
where a.k1=b.YourNamek1
and b.committeeid = 'XXXXX'

--this shouldn't happen
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where vanid is NULL

--this shouldn't happen
SELECT TOP 1000 * 
FROM EAXXX_ClientNameSourceYYYYMMDD a
JOIN van_EAXXX_contacts.dbo.contacts b(nolock)
ON a.vanid = b.vanid
WHERE b.committeeid <> 'XXXXX'

--this shouldn't happen
select vanid, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by vanid having count(*)>1

alter table EAXXX_ClientNameSourceYYYYMMDD alter column vanid int not NULL

alter table EAXXX_ClientNameSourceYYYYMMDD drop constraint PK_EAXXX_ClientNameSourceYYYYMMDD

alter table EAXXX_ClientNameSourceYYYYMMDD add constraint PK_EAXXX_ClientNameSourceYYYYMMDD primary key clustered(vanid)
---------------------------------------------------------------------------------------------------------------------------------
--Temporary Fix: Occupation and Employer have to also go into custom fields; these fields already exist, you just have to insert the data and share to the correct committees
--select top 1000 * from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD

----Occupation and Employer
----FIND/REPLACE FOR THIS SECTION ONLY: CFGID
--select top 1000 * from van_EAXXX_contacts.dbo.customfieldsgroups where groupname in('Occupation and Employer')

----Occupation: ##OcupationCFID##, Employer: ##EmployerCFID##
--select top 1000 * from van_EAXXX_contacts.dbo.customfields where customfieldsgroupid=CFGID

--select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID

--insert van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID(vanid,customfield_##OcupationCFID##value,customfield_##EmployerCFID##value)
--select vanid,a.OccupationName,a.EmployerName
--from van_EAXXX_contacts.dbo.contacts(nolock) a join EAXXX_ClientNameSourceYYYYMMDD b
--on a.vanid=b.vanid
--where a.occupationname is not null or a.employername is not null

--insert van_EAXXX_contacts.dbo.customfieldsgroupscommittees (committeeid,customfieldsgroupid,createdby,datecreated)
--select 'XXXXX', CFGID,'##',cast(getdate() as smalldatetime)
--from van_EAXXX_contacts.dbo.customfieldsgroups where groupname in ('Occupation and Employer')
--FIND/REPLACE FOR THE CUSTOM FIELD EMPLOYER/OCCUPATION SECTION ENDS HERE
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Addresses
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress

alter table EAXXX_ClientNameSourceYYYYMMDD_vaddress add vanid int

update EAXXX_ClientNameSourceYYYYMMDD_vaddress set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD_vaddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1

--this shouldn't happen
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_vaddress where vanid is null

--this shouldn't happen
select vanid, count(*) from EAXXX_ClientNameSourceYYYYMMDD_vaddress
group by vanid having count(*)>1

alter table EAXXX_ClientNameSourceYYYYMMDD_vaddress alter column vanid int not null
alter table EAXXX_ClientNameSourceYYYYMMDD_vaddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_vaddress primary key clustered(vanid)
--
alter table EAXXX_ClientNameSourceYYYYMMDD_maddress add vanid int

update EAXXX_ClientNameSourceYYYYMMDD_maddress set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD_maddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1

--this shouldn't happen
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_maddress where vanid is null

--this shouldn't happen
select vanid, count(*) from EAXXX_ClientNameSourceYYYYMMDD_maddress
group by vanid having count(*)>1

alter table EAXXX_ClientNameSourceYYYYMMDD_maddress alter column vanid int not null
alter table EAXXX_ClientNameSourceYYYYMMDD_maddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_maddress primary key clustered(vanid)
--
alter table EAXXX_ClientNameSourceYYYYMMDD_waddress add vanid int

update EAXXX_ClientNameSourceYYYYMMDD_waddress set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD_waddress a, EAXXX_ClientNameSourceYYYYMMDD b
where a.k1=b.k1

--this shouldn't happen
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_waddress where vanid is null

--this shouldn't happen
select vanid, count(*) from EAXXX_ClientNameSourceYYYYMMDD_waddress
group by vanid having count(*)>1

alter table EAXXX_ClientNameSourceYYYYMMDD_waddress alter column vanid int not null
alter table EAXXX_ClientNameSourceYYYYMMDD_waddress add constraint PK_EAXXX_ClientNameSourceYYYYMMDD_waddress primary key clustered(vanid)
--
select top 1000 * from van_EAXXX_contacts.dbo.contactsaddresses
select top 1000 * from van_main_copy.dbo.addresssources

--The front end force corrects City/State/Zip for US addresses based on Melissa standardization. Until that is changed, we should mimic that process.
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [StreetNo],
[StreetNoHalf], [StreetPrefix], [StreetName], [StreetType], [StreetSuffix], [AptType], [AptNo], [City], [State],
[Zip5], [Zip4], [CarrierRoute], [DPVFastNotes],
[DPVConfirm], [USPSAddressCode], [CreatedBy], [DateCreated],[ModifiedBy],[DateModified],addresssourceid,[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=10, left(a.[StreetNo],9), a.[StreetNoHalf], a.[StreetPrefix], a.[StreetName], left(a.[StreetType],6),
a.[StreetSuffix], left(a.[AptType],6), a.[AptNo], a.[City], a.[State], a.[Zip5], a.[Zip4], a.[CarrierRoute], left(a.[DPVFastNotes],4),
a.[DPVConfirm], a.[USPSAddressCode], [CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime),[ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),addresssourceid=11, isnull(a.countrycode,'US'),
[Address1],[Address2],[Address3],0,0
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD_vaddress a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (10,30)
	and isnull(a.streetno,'')=isnull(b.streetno,'') and isnull(a.streetname,'')=isnull(b.streetname,'')
where b.contactsaddressid is null and isnull(a.countrycode,'US')='US'--

--Non-US addresses
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [City], [ProvinceName],[postalcode],--1385
[CreatedBy], [DateCreated],[ModifiedBy],[DateModified],[AddressSourceID],[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=10, left(a.[City],25), a.[State/Province],a.[Zip/Postal Code],
[CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime), [ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),[AddressSourceID]=11, countrycode,
[Address1],[Address2],[Address3],0,1
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (10,30)
	and isnull(a.[Address1],'')=isnull(b.[AddressLine1],'') and isnull(a.[Address2],'')=isnull(b.[AddressLine2],'') and isnull(a.[Address3],'')=isnull(b.[AddressLine3],'')
where b.contactsaddressid is null and a.countrycode!='us'--
-----
--The front end force corrects City/State/Zip for US addresses based on Melissa standardization. Until that is changed, we should mimic that process.
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [StreetNo],
[StreetNoHalf], [StreetPrefix], [StreetName], [StreetType], [StreetSuffix], [AptType], [AptNo], [City], [State],
[Zip5], [Zip4], [CarrierRoute], [DPVFastNotes],
[DPVConfirm], [USPSAddressCode], [CreatedBy], [DateCreated],[ModifiedBy],[DateModified],addresssourceid,[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=20, left(a.[StreetNo],9), a.[StreetNoHalf], a.[StreetPrefix], a.[StreetName], left(a.[StreetType],6),
a.[StreetSuffix], left(a.[AptType],6), a.[AptNo], a.[City], a.[State], a.[Zip5], a.[Zip4], a.[CarrierRoute], left(a.[DPVFastNotes],4),
a.[DPVConfirm], a.[USPSAddressCode], [CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime),[ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),addresssourceid=11, isnull(a.mCountryCode,'US'),
[mAddress1],[mAddress2],[mAddress3],0,0
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD_maddress a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (20,40)
	and isnull(a.streetno,'')=isnull(b.streetno,'') and isnull(a.streetname,'')=isnull(b.streetname,'')
where b.contactsaddressid is null and isnull(a.mCountryCode,'US')='US'--

--Non-US addresses
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [City], [ProvinceName],[postalcode],--1385
[CreatedBy], [DateCreated],[ModifiedBy],[DateModified],[AddressSourceID],[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=20, left(a.[mCity],25), a.[mState],a.[mZip],
[CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime), [ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),[AddressSourceID]=11, mCountryCode,
[mAddress1],[mAddress2],[mAddress3],0,1
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (20,40)
	and isnull(a.[mAddress1],'')=isnull(b.[AddressLine1],'') and isnull(a.[mAddress2],'')=isnull(b.[AddressLine2],'') and isnull(a.[mAddress3],'')=isnull(b.[AddressLine3],'')
where b.contactsaddressid is null and a.mCountryCode!='us'--
---
--The front end force corrects City/State/Zip for US addresses based on Melissa standardization. Until that is changed, we should mimic that process.
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [StreetNo],
[StreetNoHalf], [StreetPrefix], [StreetName], [StreetType], [StreetSuffix], [AptType], [AptNo], [City], [State],
[Zip5], [Zip4], [CarrierRoute], [DPVFastNotes],
[DPVConfirm], [USPSAddressCode], [CreatedBy], [DateCreated],[ModifiedBy],[DateModified],addresssourceid,[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=50, left(a.[StreetNo],9), a.[StreetNoHalf], a.[StreetPrefix], a.[StreetName], left(a.[StreetType],6),
a.[StreetSuffix], left(a.[AptType],6), a.[AptNo], a.[City], a.[State], a.[Zip5], a.[Zip4], a.[CarrierRoute], left(a.[DPVFastNotes],4),
a.[DPVConfirm], a.[USPSAddressCode], [CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime),[ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),addresssourceid=11, isnull(a.wCountryCode,'US'),
[waddress1],[waddress2],[wAddress3],0,0
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD_waddress a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (50)
	and isnull(a.streetno,'')=isnull(b.streetno,'') and isnull(a.streetname,'')=isnull(b.streetname,'')
where b.contactsaddressid is null and isnull(a.wCountryCode,'US')='US'--

--Non-US addresses
INSERT INTO VAN_EAXXX_Contacts.dbo.contactsaddresses([VanID], [AddressType], [City], [ProvinceName],[postalcode],--1385
[CreatedBy], [DateCreated],[ModifiedBy],[DateModified],[AddressSourceID],[CountryCode],
[AddressLine1],[AddressLine2],[AddressLine3],[IsDisclosureAddress],[DisplayAsEntered])
SELECT a.[VanID], AddressType=50, left(a.[wCity],25), a.[wState],a.[wZip],
[CreatedBy]='##', [DateCreated]=cast(getdate() as smalldatetime), [ModifiedBy]='##', [DateModified]=cast(getdate() as smalldatetime),[AddressSourceID]=11, wCountryCode,
[waddress1],[waddress2],[wAddress3],0,1
--select count(*)
FROM EAXXX_ClientNameSourceYYYYMMDD a
left join VAN_EAXXX_Contacts.dbo.contactsAddresses b on a.VanID=b.VanID and b.addresstype in (50)
	and isnull(a.[waddress1],'')=isnull(b.[AddressLine1],'') and isnull(a.[waddress2],'')=isnull(b.[AddressLine2],'') and isnull(a.[wAddress3],'')=isnull(b.[AddressLine3],'')
where b.contactsaddressid is null and a.wCountryCode!='us'--
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Phones

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

select top 1000 * from van_EAXXX_contacts.dbo.contactsphones(nolock)
select top 1000 * from van_main_copy.dbo.phonesources
select top 1000 * from van_main_copy.dbo.phonetypes


/*==================================
FIND AND REPLACE FOR THIS SECTION:

select top 1000 * from van_EAXXX_contacts.dbo.notecategories WHERE notecategoryname='bad phone'

##BadPhoneNoteCategoryID##

==================================*/



/*==================================
Main Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'M' as phonetypeID,15 as phoneSourceID,NewMainphone as phone, NewMainphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newMainphone is not null and a.newMainphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newMainphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Main Phones
select top 1000 * from van_EAXXX_contacts.dbo.notecategories WHERE notecategoryname='bad phone'

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Main Phone: '+BadMainPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadMainPhoneNote is not NULL

/*==================================
Other Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'O' as phonetypeID,15 as phoneSourceID,NewOtherphone as phone, NewOtherphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newOtherphone is not null and a.newOtherphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newOtherphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Other Phones

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Other Phone: '+BadOtherPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadOtherPhoneNote is not NULL

/*==================================
Fax Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'F' as phonetypeID,15 as phoneSourceID,NewFaxphone as phone, NewFaxphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newFaxphone is not null and a.newFaxphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newFaxphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Fax Phones

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Fax Phone: '+BadFaxPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadFaxPhoneNote is not NULL

/*==================================
Cell Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'C' as phonetypeID,15 as phoneSourceID,NewCellphone as phone, NewCellphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newCellphone is not null and a.newCellphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newCellphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Cell Phones	

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Cell Phone: '+BadCellPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadCellPhoneNote is not NULL
	
/*==================================
Work Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'W' as phonetypeID,15 as phoneSourceID,NewWorkphone as phone, NewWorkphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newWorkphone is not null and a.newWorkphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newWorkphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Work Phones

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Work Phone: '+BadWorkPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadWorkPhoneNote is not NULL

/*==================================
Home Phone
==================================*/

--be careful when mass replacing the phone column name, it could mess up this query even tho it won't break
insert VAN_EAXXX_Contacts.dbo.contactsphones (vanid, phonetypeid, phonesourceid, phone, phoneext, createdby, datecreated)
select vanid, 'H' as phonetypeID,15 as phoneSourceID,Newphone as phone, NewphoneExt as phoneext, '##' as createdby, cast(getdate() as smalldatetime) as datecreated
--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD a
where a.newphone is not null and a.newphone LIKE ('[2-9][0-8][0-9][2-9][0-9][0-9][0-9][0-9][0-9][0-9]') and a.newphone not in
	(select phone from VAN_EAXXX_Contacts.dbo.contactsphones where vanid=a.vanid)

--Bad Home Phones
	
--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX','Home Phone: '+BadPhoneNote,##BadPhoneNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD
where BadPhoneNote is not NULL

/*==================================
Insert Bad Phone Note Category for Committee
==================================*/

insert van_EAXXX_contacts.dbo.NoteCategoriesCommittees(notecategoryid,committeeid,createdby,datecreated)
select ##BadPhoneNoteCategoryID##,'XXXXX','##',cast(getdate() as smalldatetime)

---------------------------------------------------------------------------------------------------------------------------------------------------------------
--Emails
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

--private, good
select top 1000 * from van_maiN_server.van_main.dbo.databases where stateid='EAXXX'
select top 1000 * from van_main_copy.dbo.committees where committeeid='XXXXX'

select top 1000 * from van_EAXXX_contacts.dbo.contactsemails(nolock)

select top 1000 * from van_maiN_server.van_main.dbo.publicemailmodes
select top 1000 * from van_maiN_server.van_main.dbo.emailtypes

--be careful when mass replacing the email column name, it could mess up this query even tho it won't break
insert van_EAXXX_contacts.dbo.contactsemails(vanid,email,createdby,datecreated,committeeid,emailsourceid,emailtypeid)
select vanid, email, '##' as createdby, cast(getdate() as smalldatetime) as datecreated, 'XXXXX' as committeeid, 13 as emailsourceid, 1 as emailtypeid
from EAXXX_ClientNameSourceYYYYMMDD  a
where a.email is not null
and a.Email not in (select email from van_EAXXX_contacts.dbo.contactsemails where a.VanID=VanID and committeeid='XXXXX')
and charindex('@',email)>0 and charindex('.',email)>0
and charindex('..',email)=0 and charindex('.@',email)=0
and left(ltrim(email),1) not in ('@','.')
and patindex('%^a-z0-9_.+@-%',ltrim(rtrim(email)))=0
and CHARINDEX('.',REVERSE(LTRIM(RTRIM(email))))>2 
and CHARINDEX('.',REVERSE(LTRIM(RTRIM(email))))<6
and charindex('@',email,charindex('@',email)+1)=0
and CHARINDEX('.',email,CHARINDEX('@',email)) - CHARINDEX('@',email)>1

--take care of the bad emails
select top 1000 * from van_EAXXX_contacts.dbo.notecategories WHERE notecategoryname='bad email'

insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select vanid,'##',cast(getdate() as smalldatetime),'XXXXX',email,##BadEmailNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD a
where email is not null and email not in(select email from van_EAXXX_contacts.dbo.contactsemails where a.VanID=VanID and committeeid='XXXXX')

insert van_EAXXX_contacts.dbo.NoteCategoriesCommittees(notecategoryid,committeeid,createdby,datecreated)
select ##BadEmailNoteCategoryID##,'XXXXX','##',cast(getdate() as smalldatetime)

--Email Subscriptions: this always has to happen regardless of if they provide subscription statuses
select top 1000 * from van_main_server.van_main.dbo.emailsubscriptionstatuses 

select top 1000 * from van_EAXXX_contacts.dbo.emailsubscriptions --where committeeid='XXXXX'

--If they gave email subscriptions: I usually insert in this order Unsubscribed, Subscribed, neutral so that the priority goes from Unsub to Sub to Neutral
--I also usually create an email subscriptions translator table to prevent any dupes
insert van_EAXXX_contacts.dbo.emailsubscriptions(email,committeeid,emailsubscriptionstatusid,datecreated,createdby,dateunsubscribed,unsubscribedby)
select distinct a.email,a.committeeid,b.emailsubscriptionstatusid,cast(getdate() as smalldatetime),'##',
dateunsubscribed=case when b.emailsubscriptionstatusid=0 then cast(getdate() as smalldatetime) else null end,--cases where this data not provided, default will be whoever's loading data on day of load
unsubscribedby=case when b.emailsubscriptionstatusid=0 then '##' else null end--cases where this data not provided, default will be whoever's loading data on day of load
from van_EAXXX_contacts.dbo.contactsemails a join EAXXX_ClientNameSourceYYYYMMDD_EmailSubscriptions b
on a.email=b.email
left join van_EAXXX_contacts.dbo.emailsubscriptions c--
on a.email=c.email and c.committeeid='XXXXX'
where c.emailsubscriptionid is NULL
and a.committeeid='XXXXX'

--THIS OFTEN BREAKS BC AN EMAIL ALREADY EXISTED FOR THAT COMMITTEE SO RELEGATE TO ONLY THE ONES YOU INSERTED
--this is if they don't have email subscription statuses, everyone has to get a neutral email subscription in that case
insert van_EAXXX_contacts.dbo.emailsubscriptions(email,committeeid,emailsubscriptionstatusid,datecreated,createdby)
select distinct a.email,a.committeeid,1,cast(getdate() as smalldatetime),'##'
from van_EAXXX_contacts.dbo.contactsemails a left join van_EAXXX_contacts.dbo.emailsubscriptions b--
on a.email=b.email and isnull(a.CommitteeID,0)=isnull(b.CommitteeID,0)
where b.email is null and a.committeeid='XXXXX'
and a.createdby='##' and a.datecreated='##yourdate##'
---------------------------------------------------------------------------------------------------------------------------------
--Temporary Fix: Client Conversion Source go into custom fields until we figure out where it's ending
select top 1000 * from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD

--Client Conversion Source
--FIND/REPLACE FOR THIS SECTION ONLY: CFGID
select top 1000 * from van_EAXXX_contacts.dbo.customfieldsgroups where groupname in('Client Conversion Source')

--Client Conversion Source: ##ClientConversionSourceCFID##
select top 1000 * from van_EAXXX_contacts.dbo.customfields where customfieldsgroupid=CFGID

select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID

insert van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID(vanid,customfield_##ClientConversionSourceCFID##value)
select vanid,ClientConversionSource
from EAXXX_ClientNameSourceYYYYMMDD b
where ClientConversionSource is not null

insert van_EAXXX_contacts.dbo.customfieldsgroupscommittees (committeeid,customfieldsgroupid,createdby,datecreated)
select 'XXXXX', CFGID,'##',cast(getdate() as smalldatetime)
from van_EAXXX_contacts.dbo.customfieldsgroups where groupname in ('Client Conversion Source')
--FIND/REPLACE FOR THE CUSTOM FIELD CLIENT CONVERSION SOURCE SECTION ENDS HERE
---------------------------------------------------------------------------------------------------------------------------------------------------------
--Salutations
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

select salutation, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by salutation
order by salutation

select envelopename, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by envelopename
order by envelopename

select top 1000 * from van_EAXXX_contacts.dbo.contactssalutations
where committeeid='XXXXX' and createdby='##'

select max(len(envelopename)) from EAXXX_ClientNameSourceYYYYMMDD--
select max(len(salutation)) from EAXXX_ClientNameSourceYYYYMMDD--

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len(salutation)>20

--
insert van_EAXXX_contacts.dbo.contactssalutations(vanid,committeeid,salutation,envelopename,createdby,datecreated)
select vanid,committeeid='XXXXX',left(salutation,20),envelopename,'##' as createdby,cast(getdate() as smalldatetime) as datecreated
from EAXXX_ClientNameSourceYYYYMMDD
where salutation is not null or envelopename is not null
-----------------------------------------------------------------------------------------------------------------------------
--ContactsAdditionalContactInformation
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

select [Website], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Website]
order by [Website]

select max(len([Website])) from EAXXX_ClientNameSourceYYYYMMDD--

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len([Website])>255

select [Nickname], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Nickname]
order by [Nickname]

select max(len([Nickname])) from EAXXX_ClientNameSourceYYYYMMDD--

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where len([Nickname])>50

select top 1000 * from van_EAXXX_contacts.dbo.ContactsAdditionalContactInformation
where committeeid='XXXXX' and createdby='##'

--
insert van_EAXXX_contacts.dbo.ContactsAdditionalContactInformation(vanid,committeeid,website,nickname,createdby,datecreated)
select vanid,committeeid='XXXXX',left(website,255),left(nickname,50),'##' as createdby,cast(getdate() as smalldatetime) as datecreated
from EAXXX_ClientNameSourceYYYYMMDD
where website is not null or nickname is not null
-----------------------------------------------------------------------------------------------------------------------------
--Notes
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where website is not null

--not committee based
select top 1000 * from van_EAXXX_contacts.dbo.notecategories

--YOU DON'T ALWAYS HAVE TO CREATE A NOTE CATEGORY, SOMETIMES IT'S NOT NECESSARY; WEBSITE AND MITZVAH DATE ARE EXAMPLES OF NOTE COLUMNS
insert van_EAXXX_contacts.dbo.notecategories(notecategoryname,isactive,createdby,datecreated,iscontact)
select 'Website',1,'##',cast(getdate() as smalldatetime),1
union select 'Mitzvah Date',1,'##',cast(getdate() as smalldatetime),1

select top 1000 * from van_EAXXX_contacts.dbo.contactsnotes(nolock) where createdby='##'

--
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select VanID,'##',cast(getdate() as smalldatetime),committeeid='XXXXX',website,##YourNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD 
where website is not null

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where [Mitzvah Date] is not null

insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select VanID,'##',cast(getdate() as smalldatetime),committeeid='XXXXX',[Mitzvah Date],##YourNoteCategoryID##
from EAXXX_ClientNameSourceYYYYMMDD 
where [Mitzvah Date] is not null

--Every note doesn't necessarily need a category
insert van_EAXXX_contacts.dbo.contactsnotes(vanid,createdby,datecreated,committeeid,notetext,notecategoryid)
select VanID,'##',cast(getdate() as smalldatetime),committeeid='XXXXX',[ContactComments],null
from EAXXX_ClientNameSourceYYYYMMDD
where [ContactComments] is not NULL

--Insert NoteCategoriesCommittees so they become visible to committee
insert van_EAXXX_contacts.dbo.NoteCategoriesCommittees(notecategoryid,committeeid,createdby,datecreated)
select ##YourNoteCategoryID##,'XXXXX','##',cast(getdate() as smalldatetime)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Relationships: this one is pretty complicated so ask away!
--FROM THE FRONT END: "Find a person John Smith knows, and choose a relationship, as in 'This person is Johns [insert relationship].'"

--THE WAY TO THINK ABOUT THE WORKFLOW IS THAT THE RELATIONSHIPID MATCHES THE RELATEDVANID; THE VANID COLUMN DENOTES THAT "THIS IS JOHN SMITH'S ROW"(WHEN HIS VANID) SO JANE SMITH'S RELATEDVANID
--WOULD MATCH TO A RELATIONSHIPID OF WIFE
select top 1000 * from VAN_EAXXX_Contacts.dbo.contactsrelationships(nolock)

--ANY TIME THAT YOUR RELATIONSHP HAS A REVERSE, YOU'LL NEED TWO ENTIRES IF AT ALL POSSIBLE
select top 1000 * from van_main_copy.dbo.relationships(nolock)

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD_affiliated

--this is the id unique to the relationships table; kind of makes sense, these are the pairs
select [AffiliatedIPK], count(*) from EAXXX_ClientNameSourceYYYYMMDD_affiliated
group by [AffiliatedIPK] having count(*)>1
order by [AffiliatedIPK]

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_affiliated where [AffiliatedIPK] in(select [AffiliatedIPK] from EAXXX_ClientNameSourceYYYYMMDD_affiliated
group by [AffiliatedIPK] having count(*)>1)
order by [AffiliatedIPK]

--
select [affiliatedContactIPK], count(*) from EAXXX_ClientNameSourceYYYYMMDD_affiliated
group by [affiliatedContactIPK] having count(*)>1
order by [affiliatedContactIPK]

--this could be weird
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_affiliated where [affiliatedContactIPK] in(select [affiliatedContactIPK] from EAXXX_ClientNameSourceYYYYMMDD_affiliated
group by [affiliatedContactIPK] having count(*)>1)
order by [affiliatedContactIPK]

--
select [AffiliatedRelatedContactIPK], count(*) from EAXXX_ClientNameSourceYYYYMMDD_affiliated 
group by [AffiliatedRelatedContactIPK] having count(*)>1
order by [AffiliatedRelatedContactIPK]
----------
--I think the one marked as Affliated Desc Child is the child and the one marked as Parent is actually the parent
select top 1000 birthdate, * from EAXXX_ClientNameSourceYYYYMMDD_affiliated where [AffiliatedIPK] in(select [AffiliatedIPK] from EAXXX_ClientNameSourceYYYYMMDD_affiliated
group by [AffiliatedIPK] having count(*)>1)
order by [AffiliatedIPK]

--Will be the related vanids relationship: Associate, Child, Employee, Employer, Parent
select [AffiliatedRelatedDesc], count(*) from EAXXX_ClientNameSourceYYYYMMDD_affiliated 
where relationshipid is null
group by [AffiliatedRelatedDesc] 
order by [AffiliatedRelatedDesc]

select top 1000 * from van_EAXXX_contacts.dbo.contactsrelationships

select top 1000 * from van_main_copy.dbo.relationships where relationshipname in('Associate','Child','Employee','Employer','Parent')

alter table EAXXX_ClientNameSourceYYYYMMDD_affiliated add RelationshipID int

update EAXXX_ClientNameSourceYYYYMMDD_affiliated set relationshipid=b.relationshipid
from EAXXX_ClientNameSourceYYYYMMDD_affiliated a, van_main_copy.dbo.relationships b
where a.[AffiliatedRelatedDesc]=b.relationshipname and b.isactive=1

select top 1000 * from van_main_copy.dbo.relationships where relationshipid=2

update EAXXX_ClientNameSourceYYYYMMDD_affiliated set relationshipid=2 where [AffiliatedRelatedDesc]='Employer'

--your call on what to do for the null relationships
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_affiliated where [AffiliatedRelatedDesc] is null

update EAXXX_ClientNameSourceYYYYMMDD_affiliated set relationshipid=7 where [AffiliatedRelatedDesc] is null
-----------------------------------
--now the most important part...
select top 1000 *--select count(*)--00, perfect
from EAXXX_ClientNameSourceYYYYMMDD_affiliated
where contactipk not in(select contactipk from EAXXX_ClientNameSourceYYYYMMDD)

select top 1000 *--select count(*)--00
from EAXXX_ClientNameSourceYYYYMMDD_affiliated
where affiliatedrelatedcontactipk not in(select contactipk from EAXXX_ClientNameSourceYYYYMMDD)

--now all i need to do is figure out the vanid/relatedvanid scenario
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

--THIS HAS TO MAP BOTH RELATIONSHIPS, BOTH SIDES OF THE RELATIONSHIP(RELATIONSHIPNAMEREVERSE)
insert van_EAXXX_contacts.dbo.contactsrelationships(vanid,relatedvanid,relationshipid,committeeid,createdby,datecreated)
select --
--select top 1000 b.vanid,c.vanid,*,
b.VanID,c.VanID as RelatedVanID,a.RelationshipID, committeeid='XXXXX', '##' as createdby, cast([AffiliatedDateAdded] as datetime) as DateCreated
from EAXXX_ClientNameSourceYYYYMMDD_affiliated a join EAXXX_ClientNameSourceYYYYMMDD b
on a.contactipk=b.contactipk
join EAXXX_ClientNameSourceYYYYMMDD c
on a.affiliatedrelatedcontactipk=c.contactipk
order by [AffiliatedIPK]

--IF YOU WANT TO CHECK JOHN SMITH'S RELATIONSHIPS PAGE SECTION ON CONTACTSDETAILS, YOU'D NOTICE THAT HE WOULD HAVE AN ENTRY THAT LOOKS LIKE THE BELOW
--PERSON: JANE SMITH; RELATIONSHP: WIFE

--JANE SMITH'S WOULD HAVE A SIMILAR WORKFLOW
--PERSON: JOHN SMITH; RELATIONSHP: HUSBAND
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Activist Codes, AC Type should alsmost always be the same thing
select top 1000 * from van_main_copy.dbo.activistcodes where ownercommitteeid='XXXXX'
select top 1000 * from van_main_copy.dbo.activistcodetypes
select top 1000 * from van_main_copy.dbo.CommitteesActivistCodes where committeeid='XXXXX'

--No, Yes: AC
select [DonationIsAnonymous], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [DonationIsAnonymous]
order by [DonationIsAnonymous]

--If you're creating one AC at a time, I'd adapt this one; if you're using the AC Translator from a client can still use most of this
--ActivistCodeID: 
insert van_main_server.van_Main.dbo.activistcodes(stateid,clientid,activistcodetype,activistcodename,palmname,veryshortname,description,createdby,committeecreatedby,datecreated,
ScopeID,ISActivist,WebAssign,WebSearch,Active,WebEnabled,IsMunicipal,IsCounty,IsDistrict,IsState,IsFederal,IsElected,
IsKeyActivist,WebSearchPres,DemPoints,RepPoints,IndPoints,IsMultiAssign,AppliesToOrganization,StatewideCode,DatabaseModeFlag,Official,ownercommitteeid,
IsRenewal,IsStateAdminDistribute,
activistcodenameotherlanguage,palmnameotherlanguage,veryshortnameotherlanguage,descriptionotherlanguage,activistcodetypeid,ActionTypeID, CampaignID)
select 'EAXXX','EA','Donor','Anonymous Donor' as activistcodename,left('Anonymous Donor',9) as palmname,left('Anonymous Donor',3) as veryshortname,'Anonymous Donor' as activistcodedescription,
'##','XXXXX',cast(getdate() as smalldatetime),
1 as ScopeID,0 as ISActivist, 1 as WebAssign, 1 as WebSearch, 1 as Active, 1 as WebEnabled, 0 as IsMunicipal, 0 as IsCounty, 0 as IsDistrict, 0 as IsState, 0 as IsFederal, 0 as IsElected,
0 as IsKeyActivist,0 as WebSearchPres, 0 as DemPoints, 0 as RepPoints, 0 as IndPoints, 0 as IsMultiAssign, 0 as AppliesToOrganization, 0 as StatewideCode, 1 as DatabaseModeFlag, 0 as Official,
'XXXXX', 0 as IsRenewal, 0 as IsStateAdminDistribute,
'Anonymous Donor' as activistcodenameotherlanguage,left('Anonymous Donor',9) as palmnameotherlanguage,left('Anonymous Donor',3) as veryshortnameotherlanguage, 
'Anonymous Donor' as descriptionotherlanguage,18 as activistcodetypeid, 0 as ActionTypeID, 0 as CampaignID

select top 1000 * from van_EAXXX_contacts.dbo.contactsactivistcodes where createdby='##'
order by datecreated desc

insert van_EAXXX_contacts.dbo.contactsactivistcodes(vanid,activistcodeid,committeeid,createdby,datecreated,inputtypeid,contacttypeid)
select distinct vanid,##YourActivistCodeID##,'XXXXX','##',cast(getdate() as smalldatetime),5,14
from EAXXX_ClientNameSourceYYYYMMDD a join EAXXX_ClientNameSourceYYYYMMDD b
on a.[ContactIPK]=b.[ContactIPK]
where [DonationIsAnonymous]='yes'

--No,Yes: AC
select [DonationIsPledge], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [DonationIsPledge]
order by [DonationIsPledge]

--
insert van_maiN_server.van_Main.dbo.activistcodes(stateid,clientid,activistcodetype,activistcodename,palmname,veryshortname,description,createdby,committeecreatedby,datecreated,
ScopeID,ISActivist,WebAssign,WebSearch,Active,WebEnabled,IsMunicipal,IsCounty,IsDistrict,IsState,IsFederal,IsElected,
IsKeyActivist,WebSearchPres,DemPoints,RepPoints,IndPoints,IsMultiAssign,AppliesToOrganization,StatewideCode,DatabaseModeFlag,Official,ownercommitteeid,
IsRenewal,IsStateAdminDistribute,
activistcodenameotherlanguage,palmnameotherlanguage,veryshortnameotherlanguage,descriptionotherlanguage,activistcodetypeid,ActionTypeID, CampaignID)
select 'EAXXX','EA','Donor','Pledge Donation' as activistcodename,left('Pledge Donation',9) as palmname,left('Pledge Donation',3) as veryshortname,'Pledge Donation' as activistcodedescription,
'##','XXXXX',cast(getdate() as smalldatetime),
1 as ScopeID,0 as ISActivist, 1 as WebAssign, 1 as WebSearch, 1 as Active, 1 as WebEnabled, 0 as IsMunicipal, 0 as IsCounty, 0 as IsDistrict, 0 as IsState, 0 as IsFederal, 0 as IsElected,
0 as IsKeyActivist,0 as WebSearchPres, 0 as DemPoints, 0 as RepPoints, 0 as IndPoints, 0 as IsMultiAssign, 0 as AppliesToOrganization, 0 as StatewideCode, 1 as DatabaseModeFlag, 0 as Official,
'XXXXX', 0 as IsRenewal, 0 as IsStateAdminDistribute,
'Pledge Donation' as activistcodenameotherlanguage,left('Pledge Donation',9) as palmnameotherlanguage,left('Pledge Donation',3) as veryshortnameotherlanguage, 
'Pledge Donation' as descriptionotherlanguage,18 as activistcodetypeid, 0 as ActionTypeID, 0 as CampaignID

select top 1000 * from van_EAXXX_contacts.dbo.contactsactivistcodes where createdby='##'
order by datecreated desc

--
insert van_EAXXX_contacts.dbo.contactsactivistcodes(vanid,activistcodeid,committeeid,createdby,datecreated,inputtypeid,contacttypeid)
select distinct vanid,##YourActivistCodeID##,'XXXXX','##',cast(getdate() as smalldatetime),5,14
from EAXXX_ClientNameSourceYYYYMMDD a join EAXXX_ClientNameSourceYYYYMMDD b
on a.[ContactIPK]=b.[ContactIPK]
where [DonationIsPledge]='yes'

--ALWAYS NEED TO DO THESE TWO QUERIES FOR ACS YOU CREATED
insert van_main_server.van_main.dbo.CommitteesActivistCodes
select 'XXXXX',activistcodeid,'##',cast(getdate() as smalldatetime)--
--select top 1000 *
from van_main_server.van_main.dbo.ActivistCodes
where stateid='EAXXX' and ownercommitteeid='XXXXX'

insert van_main_server.van_main.dbo.ActivistCodesDatabases--
select activistcodeid,'EAXXX',1,'##',cast(getdate() as smalldatetime)
from van_main_server.van_main.dbo.ActivistCodes
where stateid='EAXXX' and ownercommitteeid='XXXXX'
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Custom Fields: THE NAMES AND FIELDS USED HERE ARE EXAMPLES
select [Equipment], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [Equipment]
order by [Equipment]

select max(len([Equipment])) from EAXXX_ClientNameSourceYYYYMMDD--118

--some sort of subject header? custom field bc not sure where else to put it
select [DonationAppeal], count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by [DonationAppeal]
order by [DonationAppeal]

select max(len([DonationAppeal])) from EAXXX_ClientNameSourceYYYYMMDD--45

use van_EAXXX_contacts

--Custom Fields stuff
select top 1000 * from van_EAXXX_contacts.dbo.customfields

select top 1000 * from van_EAXXX_contacts.dbo.customfieldsgroups

--MIGHT WANT TO ADJUST THESE FOR LENGTH, DISPLAY FIELDS AND CUSTOM FIELDS HAVE DIFFT. LENGTHS
-----FIND/REPLACE FOR THIS SECTION ONLY: CFGID
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Pitch In For Baseball'-->Client Name/Group Name
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Equipment'-->Large Name 1
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Equip'-->Medium Name 1
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Eqp'-->Short Name 1
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Equipment'-->Plural Name 1
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Donation Appeal'-->Large Name 2
-----FIND/REPLACE FOR THIS SECTION ONLY: 'DonAp'-->Medium Name 2
-----FIND/REPLACE FOR THIS SECTION ONLY: 'DAp'-->Short Name 2
-----FIND/REPLACE FOR THIS SECTION ONLY: 'Donation Appeals'-->Plural Name 2
insert van_EAXXX_contacts.dbo.customfieldsgroups (groupname,createdby,datecreated,tablename, fieldname,isdisplaylabel,sortorder,databasemodeflag)
values ('Pitch In For Baseball','##',cast(getdate() as smalldatetime),'Contacts','VanID',1,0,1)
--------------
--These are for text fields, not lookup tables
insert van_EAXXX_contacts.dbo.customfields (customfieldname,customfieldmediumname,customfieldshortname,committeeid,isopentext,createdby,datecreated,contactsdetailspagesectionname,createalistpagesectionname,
ispickable,iseditable,customfieldpluralname,customfieldsgroupid,customfielddsiplaylength,customfieldmaxsize,isdistrictsassigned,isbulkuploadrequired,isbulkuploaddefault,isbulkupload,isemailmerge)
select 'Equipment','Equip','Eqp','XXXXX',1,'##',cast(getdate() as smalldatetime),'CustomFieldsDefault','CustomFieldsDefault',1,1,'Equipment',
customfieldsgroupid = (select customfieldsgroupid from van_EAXXX_contacts.dbo.customfieldsgroups where groupname = 'Pitch In For Baseball'),30,75,
0,0,0,1,0

insert van_EAXXX_contacts.dbo.customfields (customfieldname,customfieldmediumname,customfieldshortname,committeeid,isopentext,createdby,datecreated,contactsdetailspagesectionname,createalistpagesectionname,
ispickable,iseditable,customfieldpluralname,customfieldsgroupid,customfielddsiplaylength,customfieldmaxsize,isdistrictsassigned,isbulkuploadrequired,isbulkuploaddefault,isbulkupload,isemailmerge)
select 'Donation Appeal','DonAp','DAp','XXXXX',1,'##',cast(getdate() as smalldatetime),'CustomFieldsDefault','CustomFieldsDefault',1,1,'Donation Appeals',
customfieldsgroupid = (select customfieldsgroupid from van_EAXXX_contacts.dbo.customfieldsgroups where groupname = 'Pitch In For Baseball'),30,75,
0,0,0,1,0

--the custom fields you created above
select top 1000 * from van_EAXXX_contacts.dbo.customfields WHERE createdby='##' AND committeeid='XXXXX'
-------------------
select 'exec van_EAXXX_contacts.dbo.usp_createcustomfield ' + cast(customfieldid as varchar(5))
from van_EAXXX_contacts.dbo.customfields where customfieldname in
('Donation Appeal','Equipment')

--Paste results here
exec van_EAXXX_contacts.dbo.usp_createcustomfield 30
exec van_EAXXX_contacts.dbo.usp_createcustomfield 31

--
select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID

--might want to check this didn't break the view
exec van_EAXXX_contacts.dbo.usp_generatecontactsdisplayview

select top 1000 * from VAN_EAXXX_Contacts_UserData.EAXXX_User.ContactsCustomFields_CFGID

--change the group id; i think everyone gets this page section now
insert CustomFieldsGroupsPageSections
select CFGID,624,'##',cast(getdate() as smalldatetime)

select top 1000 * from CustomFieldsGroupsPageSections
-----------------------
select top 1000 * from van_EAXXX_contacts.dbo.customfields

exec van_EAXXX_contacts.dbo.usp_generatecustomfielddistricts CFGID
-----------------------------
select top 1000 * from van_EAXXX_contacts.dbo.customfieldsgroupscommittees

insert van_EAXXX_contacts.dbo.customfieldsgroupscommittees (committeeid,customfieldsgroupid,createdby,datecreated)
select 'XXXXX', customfieldsgroupid,'##',cast(getdate() as smalldatetime)
from van_EAXXX_contacts.dbo.customfieldsgroups where groupname in ('Pitch In For Baseball')
----------
select top 1000 * from van_EAXXX_contacts.dbo.customfields WHERE customfieldsgroupid=CFGID
---------------------------------------------
select top 1000 * from van_EAXXX_contacts.dbo.displayfields
where displayfielddbvalue like '%CustomFields|%'

--PROBABLY NEED TO CHANGE THE EXPORTBLOCKNUMBER SO THAT THE SAME CUSTOM FIELD GROUP IS IN A NEW EXPORT BLOCK
insert van_EAXXX_contacts.dbo.displayfields (displayfieldlongname,displayfieldmediumname,displayfieldshortname,displayfielddbvalue,isinview,isexport,exportblocknumber,isreport,reportfieldchars,
isemailmerge,sample1,sample2,sample3,sample4,sample5,sample6,createdby,datecreated,
iscontactsdetails,databasemodeflag,ispalmformat,islabel,IsVirtualPhoneBank,IsMergePickable,IsAPICustomProperty)
select 'Equipment','Equip','Eqp',
displayfielddbvalue = (select 'CustomFields|' + cast(customfieldid as varchar(5)) from van_EAXXX_contacts.dbo.customfields where customfieldname = 'Equipment'),
0,1,##YourExportBlockNumber##,1,30,0,sample1='Pitch In For Baseball: '+'Equipment',sample2='Pitch In For Baseball: '+'Equipment',sample3='Pitch In For Baseball: '+'Equipment',
sample4='Pitch In For Baseball: '+'Equipment',sample5='Pitch In For Baseball: '+'Equipment',sample6='Pitch In For Baseball: '+'Equipment',
'##',cast(getdate() as smalldatetime),0,1,0,0,0,0,0

insert van_EAXXX_contacts.dbo.displayfields (displayfieldlongname,displayfieldmediumname,displayfieldshortname,displayfielddbvalue,isinview,isexport,exportblocknumber,isreport,reportfieldchars,
isemailmerge,sample1,sample2,sample3,sample4,sample5,sample6,createdby,datecreated,
iscontactsdetails,databasemodeflag,ispalmformat,islabel,IsVirtualPhoneBank,IsMergePickable,IsAPICustomProperty)
select 'Donation Appeal','DonAp','DAp',
displayfielddbvalue = (select 'CustomFields|' + cast(customfieldid as varchar(5)) from van_EAXXX_contacts.dbo.customfields where customfieldname = 'Donation Appeal'),
0,1,##YourExportBlockNumber##,1,30,0,sample1='Pitch In For Baseball: '+'Donation Appeal',sample2='Pitch In For Baseball: '+'Donation Appeal',sample3='Pitch In For Baseball: '+'Donation Appeal',
sample4='Pitch In For Baseball: '+'Donation Appeal',sample5='Pitch In For Baseball: '+'Donation Appeal',sample6='Pitch In For Baseball: '+'Donation Appeal',
'##',cast(getdate() as smalldatetime),0,1,0,0,0,0,0

select top 1000 * from van_EAXXX_contacts.dbo.displayfields

select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.customfield_30
select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.customfield_31

select top 1000 * from van_EAXXX_contacts_userdata.EAXXX_User.ContactsCustomFields_CFGID
-------FIND/REPLACE FOR THE CUSTOM FIELDS SECTION ENDS HERE----------

--------------------------------------------------------------------------------------------------------CONTRIBUTIONS------------------------------------------------------------------------------------------------------------------------------------

--------------source codes-----------------

SELECT TOP 10 * FROM VAN_EAXXX_Contacts.DBO.Codes (NOLOCK)
SELECT TOP 10 * FROM VAN_EAXXX_Contacts.DBO.CommitteesCodes (NOLOCK)

SELECT TOP 100 * FROM VAN_MAIN_Copy.DBO.Entities (NOLOCK) --WHERE EntityName LIKE '%contrib%' OR EntityName LIKE '%pledge%'
--11	ContactsContributions
--12	ContactsRecurringContributions
--15	ContactsPledges
--16	ContactsOnlineForms
SELECT TOP 10 * FROM VAN_EAXXX_Contacts.DBO.EntitiesCodes (NOLOCK)

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes

SELECT DISTINCT EveryActionSourceCodeName, EveryActionSourceCodeDescription 
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes 
WHERE EveryActionParentSourceCodeName IS NULL 

--create parent codes

SELECT TOP 100 * FROM VAN_EAXXX_Contacts.dbo.codes (NOLOCK)

INSERT INTO VAN_EAXXX_Contacts.dbo.Codes
        (CodeName ,
          CommitteeID ,
          IsActive ,
          ParentCodeID ,
          CreatedBy ,
          DateCreated ,
          CreatedByCommitteeID ,
          CodeDescription ,
          StaticFullName
        )
		SELECT DISTINCT
		EveryActionSourceCodeName,
		'XXXXX',
		1,
		NULL,
		'##',
		 CAST(GETDATE() AS SMALLDATETIME),
		'XXXXX',
		EveryActionSourceCodeDescription,
		EveryActionSourceCodeName

		--select DISTINCT EveryActionSourceCodeName, EveryActionSourceCodeDescription 
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes 
WHERE EveryActionParentSourceCodeName IS NULL 

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes 

SELECT DISTINCT c.CodeID AS parentcodeid, c.CodeName AS parentcodename, sc.EveryActionParentSourceCodeName, sc.EveryActionSourceCodeName
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes sc
LEFT JOIN VAN_EAXXX_Contacts.DBO.Codes c
ON sc.EveryActionParentSourceCodeName = c.CodeDescription
AND c.CommitteeID = 'XXXXX'
where sc.EveryActionParentSourceCodeName IS NOT NULL 

alter table dbo.EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES add ParentCodeID INT

--create child codes

UPDATE sc 
SET sc.ParentCodeID = c.codeid
--SELECT DISTINCT c.CodeID AS parentcodeid, c.CodeName AS parentcodename, sc.EveryActionParentSourceCodeName, sc.EveryActionSourceCodeName
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes sc
LEFT JOIN VAN_EAXXX_Contacts.DBO.Codes c
ON sc.EveryActionParentSourceCodeName = c.CodeDescription
AND c.CommitteeID = 'XXXXX'
where sc.EveryActionParentSourceCodeName IS NOT NULL 


INSERT INTO VAN_EAXXX_Contacts.dbo.Codes
        ( 
          CodeName ,
          CommitteeID ,
          IsActive ,
          ParentCodeID ,
          CreatedBy ,
          DateCreated ,
          CreatedByCommitteeID ,
          CodeDescription ,
          StaticFullName
        )
		SELECT DISTINCT
		EveryActionSourceCodeName,
		'XXXXX',
		1,
		ParentCodeID,
		'##',
		 CAST(GETDATE() AS SMALLDATETIME),
		'XXXXX',
		EveryActionSourceCodeDescription,
		EveryActionSourceCodeName

		--select DISTINCT EveryActionSourceCodeName, EveryActionSourceCodeDescription 
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes 
WHERE EveryActionParentSourceCodeName IS NOT NULL 

alter table dbo.EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES add CodeID INT

UPDATE sc 
SET sc.CodeID = c.CodeID
--SELECT DISTINCT c.CodeID AS codeid, c.CodeName AS codename, sc.EveryActionParentSourceCodeName, sc.EveryActionSourceCodeName
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes sc
left JOIN VAN_EAXXX_Contacts.DBO.Codes c
ON sc.EveryActionSourceCodeDescription = c.CodeDescription
AND sc.ParentCodeID = c.ParentCodeID
AND c.CommitteeID = 'XXXXX'

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES ORDER BY codeid 

--other tables needed to activate Codes 

INSERT INTO VAN_EAXXX_Contacts.dbo.CommitteesCodes
        ( CommitteeID ,
          CodeID ,
          CreatedBy ,
          DateCreated
        )
SELECT
'XXXXX',
c.CodeID, 
'##',
CAST(GETDATE() AS SMALLDATETIME)

--select * 
FROM VAN_EAXXX_Contacts.DBO.Codes c
WHERE c.CommitteeID = 'XXXXX'
AND c.CreatedBy = '##'

SELECT TOP 100 * FROM VAN_MAIN_Copy.DBO.Entities (NOLOCK) --WHERE EntityName LIKE '%contrib%' OR EntityName LIKE '%pledge%'
--11	ContactsContributions
--12	ContactsRecurringContributions
--15	ContactsPledges
----16	ContactsOnlineForms
SELECT TOP 100 * FROM VAN_EAXXX_Contacts.DBO.EntitiesCodes (NOLOCK)

INSERT INTO VAN_EAXXX_Contacts.dbo.EntitiesCodes
        ( EntityID ,
          CodeID ,
          IsApplicable ,
          CreatedBy ,
          DateCreated
        )
SELECT
15,
c.CodeID,
2,
'##',
CAST(GETDATE() AS SMALLDATETIME)

		--select * 
FROM VAN_EAXXX_Contacts.DBO.Codes c
WHERE c.CommitteeID = 'XXXXX'
AND c.CreatedBy = '##'

--archive some codes

SELECT * 
FROM EAXXX_ClientNameSourceYYYYMMDD_SourceCodes
WHERE note = 'inactive'

select * 
FROM VAN_EAXXX_Contacts.DBO.Codes c
WHERE c.CommitteeID = 'XXXXX'
AND c.CreatedBy = '##'


SELECT *
FROM VAN_EAXXX_Contacts.DBO.Codes c
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_SourceCodes sc
ON sc.CodeID = c.CodeID
--AND sc.ParentCodeID = c.ParentCodeID
WHERE c.CommitteeID = 'XXXXX'
AND c.CreatedBy = '##'
AND sc.note = 'inactive'

UPDATE c 
SET c.IsActive = 0
--SELECT c.IsActive
FROM VAN_EAXXX_Contacts.VAN_MAIN.dbo.Codes c
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_SourceCodes sc
ON sc.CodeID = c.CodeID
WHERE c.CommitteeID = 'XXXXX'
AND c.CreatedBy = '##'
AND sc.note = 'inactive'

-------------------------------add codes to contributions and pledges table

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES
SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g

--parent codes
alter table dbo.EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges add fund_codeid INT

SELECT distinct g.Gf_Fund, s.[EnvisionUnlimittedFund AppealName], s.EveryActionSourceCodeName, s.CodeID
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
left JOIN EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES s
ON g.Gf_Fund = s.[EnvisionUnlimittedFund AppealName]
ORDER BY g.Gf_Fund, s.CodeID


UPDATE g
SET fund_codeid = s.CodeID
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
left JOIN EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES s
ON g.Gf_Fund = s.[EnvisionUnlimittedFund AppealName]

--child codes

UPDATE EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges SET Gf_Fund = 'AA' WHERE Gf_Fund = 'Annual Appeal'

SELECT * 
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges

SELECT * --SELECT DISTINCT g.Gf_Fund,s.EveryActionParentSourceCodeName, g.Gf_Appeal, s.EveryActionSourceCodeName, s.CodeID
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES s
ON g.fund_codeid = s.ParentCodeID
AND g.Gf_Appeal = s.[EnvisionUnlimittedFund AppealName]
ORDER BY s.CodeID

UPDATE g 
SET appeal_codeid = 149637
--SELECT *
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_SOURCECODES s
ON g.fund_codeid = s.ParentCodeID
AND g.Gf_Appeal = s.[EnvisionUnlimittedFund AppealName]
AND G.appeal_codeid IS NULL 

--where code does not have a parent

UPDATE EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges
SET appeal_codeid = fund_codeid
-- SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges
WHERE appeal_codeid IS NULL 

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges




--------------------------------------------------------------------------insert contributions

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges
SELECT TOP 10 * FROM VAN_EAXXX_Contacts.dbo.ContactsContributions (NOLOCK)

alter table dbo.EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges add vanid INT

update EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges a, EAXXX_ClientNameSourceYYYYMMDD b
where a.Gf_CnBio_System_ID=b.CnBio_System_ID

SELECT * FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges WHERE vanid IS NULL 

-- ContributionSourceID
--PaymentTypeID
--DonationStatusID
--ContributionStatusID
--FinancialProgramID

SELECT TOP 10 * FROM VAN_MAIN_Copy.dbo.ContributionSourceTypes
SELECT TOP 10 *FROM VAN_MAIN_Copy.dbo.DonationStatuses
SELECT TOP 10 *FROM VAN_MAIN_Copy.dbo.ContributionStatuses
SELECT TOP 10 * FROM VAN_MAIN_Copy.dbo.PaymentTypes (NOLOCK)
SELECT TOP 10 *FROM VAN_EAXXX_Contacts.dbo.FinancialPrograms (NOLOCK) WHERE CommitteeID = 'XXXXX'
SELECT DISTINCT [Type for Insert] FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges ORDER BY [Type for Insert]


INSERT INTO VAN_EAXXX_Contacts.dbo.ContactsContributions
        ( VanID ,
          Amount ,
          DateReceived ,
          DateCreated ,
          CreatedBy ,
          CommitteeID ,
          DateModified ,
          ModifiedBy ,
          Notes ,
          PaymentTypeID ,
          DonationStatusID ,
          ContributionStatusID ,
          FinancialProgramID ,
          GatewayAccountTransactionID ,
          CheckDate ,
          CheckNumber 
        )
SELECT
g.vanid, 
g.Gf_Amount, 
CASE WHEN ISDATE(g.Gf_Date) = 1 THEN g.Gf_Date ELSE CAST(GETDATE() AS SMALLDATETIME) END,
CAST(GETDATE() AS SMALLDATETIME),
'##',
'XXXXX',
CAST(GETDATE() AS SMALLDATETIME),
'##',
ISNULL('Anonymous: ' + [g].[Gf_Anonymous],'')  + ISNULL('| Gift Type: ' + g.Gf_Type,'')+ ISNULL('| Payment Method: ' + g.Gf_Pay_method,'')+ ISNULL('| Reference: ' + g.Gf_Reference,''),
CASE WHEN g.[Type for Insert] = 'cash' THEN 6 
WHEN g.[Type for Insert] = 'check' THEN 1
WHEN  g.[Type for Insert] = 'credit card' THEN 7
WHEN  g.[Type for Insert] = 'Gift-in-Kind'THEN 9
WHEN g.[Type for Insert] = 'Other' THEN 10
ELSE 10 END, 
1,
3,
179,
g.Gf_System_ID,
CASE WHEN ISDATE(g.Gf_Check_date) = 1 THEN g.Gf_Date ELSE NULL END,
g.Gf_Check_number

--select * 
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
WHERE [Type for Insert] <> 'pledge'

SELECT * FROM VAN_EAXXX_Contacts.dbo.ContactsContributions WHERE CommitteeID = 'XXXXX'

--contributions codes

SELECT cc.ContactsContributionID, g.appeal_codeid
FROM VAN_EAXXX_Contacts.dbo.ContactsContributions cc
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
ON g.vanid = cc.VanID
AND g.Gf_System_ID = GatewayAccountTransactionID
WHERE cc.CommitteeID = 'XXXXX'

INSERT INTO VAN_EAXXX_Contacts.dbo.ContactsContributionsCodes
        ( ContactsContributionID ,
          CodeID ,
          CreatedBy ,
          DateCreated
        )
SELECT
cc.ContactsContributionID,
g.appeal_codeid,
'##',
GETDATE()

--SELECT cc.ContactsContributionID, g.appeal_codeid
FROM VAN_EAXXX_Contacts.dbo.ContactsContributions cc
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
ON g.vanid = cc.VanID
AND g.Gf_System_ID = GatewayAccountTransactionID
WHERE cc.CommitteeID = 'XXXXX'


--------------------------------------------------------------------------insert pledges

SELECT * 
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges
WHERE [Type for Insert] = 'pledge'

SELECT TOP 100 * FROM VAN_MAIN_Copy.dbo.PledgeTypes (NOLOCK)
SELECT TOP 100 * FROM VAN_MAIN_Copy.dbo.CommitmentLevels
SELECT TOP 100 * FROM VAN_MAIN_Copy.dbo.FulfillmentStatuses
SELECT TOP 100 * FROM VAN_MAIN_Copy.dbo.PledgeConditionalTypes

SELECT TOP 100 * FROM VAN_EAXXX_Contacts.dbo.ContactsPledges (NOLOCK)


INSERT INTO VAN_EAXXX_Contacts.dbo.ContactsPledges
        ( VanID ,
          CommitteeID ,
          TotalAmount ,
          DatePledged ,
          PledgeTypeID ,
          CommitmentLevelID ,
          FulfillmentStatusID ,
          FinancialProgramID ,
          PledgeConditionalTypeID ,
          DateCreated ,
          CreatedBy ,
          DateModified ,
          ModifiedBy ,
          Notes,
		  ContactsPledgesk1
        )
		SELECT
		p.vanid,
		'XXXXX',
		p.Gf_Amount,
		p.Gf_Date,
		1,
		3,
		1,
		179,
		1,
		GETDATE(),
		'##',
		GETDATE(),
		'##',
		p.Gf_Reference,
		p.Gf_System_ID

--SELECT * 
FROM EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges p
WHERE [Type for Insert] = 'pledge'


--pledges codes

SELECT cc.ContactsContributionID, g.appeal_codeid
FROM VAN_EAXXX_Contacts.dbo.ContactsContributions cc
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
ON g.vanid = cc.VanID
AND g.Gf_System_ID = GatewayAccountTransactionID
WHERE cc.CommitteeID = 'XXXXX'

INSERT INTO VAN_EAXXX_Contacts.dbo.ContactsPledgesCodes
        ( ContactsPledgeID ,
          CodeID ,
          CreatedBy ,
          DateCreated
        )
SELECT
cc.ContactsPledgeID,
g.appeal_codeid,
cc.CreatedBy,
GETDATE()

--SELECT cc.ContactsPledgeID, g.appeal_codeid
FROM VAN_EAXXX_Contacts.dbo.ContactsPledges cc
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD_GiftsPledges g
ON g.vanid = cc.VanID
AND g.Gf_System_ID = cc.ContactsPledgesk1
WHERE cc.CommitteeID = 'XXXXX'

---------------------------------------soft credits
SELECT * 
FROM EAXXX_ClientNameSourceYYYYMMDD_SoftCredits

SELECT e.vanid, sc.* 
FROM EAXXX_ClientNameSourceYYYYMMDD_SoftCredits sc
INNER JOIN EAXXX_ClientNameSourceYYYYMMDD e
ON e.CnBio_ID = sc.Constit_ID_SOFTCREDIT

alter table dbo.EAXXX_ClientNameSourceYYYYMMDD_SoftCredits add vanid INT

update EAXXX_ClientNameSourceYYYYMMDD_SoftCredits set vanid=b.vanid
from EAXXX_ClientNameSourceYYYYMMDD_SoftCredits a, EAXXX_ClientNameSourceYYYYMMDD b
where a.Constit_ID_SOFTCREDIT=b.CnBio_ID

SELECT cc.ContactsContributionID, sc.*
FROM EAXXX_ClientNameSourceYYYYMMDD_SoftCredits sc
left JOIN VAN_EAXXX_Contacts.dbo.ContactsContributions cc (NOLOCK) 
ON sc.Gf_System_ID = cc.GatewayAccountTransactionID
and cc.CommitteeID = 'XXXXX'
AND cc.CreatedBy = '##'

SELECT *
FROM  VAN_EAXXX_Contacts.dbo.ContactsContributionsAttributedContacts (NOLOCK)


INSERT INTO VAN_EAXXX_Contacts.dbo.ContactsContributionsAttributedContacts
        ( ContactsContributionID ,
          AttributedVanID ,
          DateCreated ,
          CreatedBy 
        )
SELECT DISTINCT
cc.ContactsContributionID,
cc.VanID,
GETDATE(),
'##'

--SELECT cc.ContactsContributionID, sc.*
FROM EAXXX_ClientNameSourceYYYYMMDD_SoftCredits sc
inner JOIN VAN_EAXXX_Contacts.dbo.ContactsContributions cc (NOLOCK) 
ON sc.Gf_System_ID = cc.GatewayAccountTransactionID
and cc.CommitteeID = 'XXXXX'
AND cc.CreatedBy = '##'


SELECT *
FROM  VAN_EAXXX_Contacts.dbo.ContactspledgesAttributedContacts (NOLOCK)


INSERT INTO VAN_EAXXX_Contacts.dbo.ContactspledgesAttributedContacts
        ( ContactspledgeID ,
          AttributedVanID ,
          DateCreated ,
          CreatedBy 
        )
SELECT DISTINCT
cc.ContactsPledgeID,
cc.VanID,
GETDATE(),
'##'

--SELECT cc.ContactsPledgeID, sc.*
FROM EAXXX_ClientNameSourceYYYYMMDD_SoftCredits sc
inner JOIN VAN_EAXXX_Contacts.dbo.ContactsPledges cc (NOLOCK) 
ON sc.Gf_System_ID = cc.ContactsPledgesk1
and cc.CommitteeID = 'XXXXX'
AND cc.CreatedBy = '##'



--------------------------------------------------------------------------------------------------------------------------
--External IDs: If your externalid isn't specific to the former CRM then use "EveryAction Client ID"
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD

--this doesn't work if they're not unique
select contactipk, count(*) from EAXXX_ClientNameSourceYYYYMMDD
group by contactipk having count(*)>1
--order by contactipk

--does anyone not have the ID?
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where contactipk is null or contactipk=0

--are the settings any different?
select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD where contactipk like '%[^0-9]%'

--If any of the settings look difft., should probably talk to TO
select top 1000 * from van_main_server.van_Main.dbo.externalidtypes 
where externalidtypename in('EveryAction Client ID','BSD ID','Databank ID','Donor Perfect ID','DonorSnap ID','eTapestry ID','NationBuilder ID',
'Raiser''s Edge ID','SalesForce ID','Salsa ID','EveryAction7 ID','Convio ID')

--the externalids should already exist in EAXXX; if the settings look difft., contact TO
select top 1000 * from van_main_server.van_Main.dbo.externalidtypesdatabases where externalidtypeid in(1,10,97,98,99,100,101,89,40,96,95) and stateid='EAXXX'
---
--always need to make sure tha the committee is given access to the ExternalID
select top 10 * from van_main_server.van_main.dbo.externalidtypesdatabasescommittees where stateid='EAXXX'

insert van_main_server.van_main.dbo.externalidtypesdatabasescommittees(externalidtypeid,stateid,databasemodeid,committeeid)
select ##YourExternalIDTypeID##,'EAXXX',1,'XXXXX'

select top 100 * from van_EAXXX_contacts.dbo.contactsexternalids

insert van_EAXXX_contacts.dbo.contactsexternalids(vanid,externalidtypeid,externalid,createdby,datecreated,committeeid)
select distinct vanid,##YourExternalIDTypeID##,contactipk,'##',cast(getdate() as smalldatetime),'XXXXX'--
from EAXXX_ClientNameSourceYYYYMMDD where contactipk is not null
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--AFTER EVERYTHING IS LOADED
use van_EAXXX_contacts

select Phone,ContactsPhoneID,0 as IsCellPhoneExchange into #TempContactsPhones--
  from VAN_EAXXX_Contacts.dbo.contactsphones where IsCellPhoneExchange <> 1

update #TempContactsPhones set IsCellPhoneExchange = 1
  from #TempContactsPhones a join VAN_EAXXX_Contacts_Temp.dbo.MainCopyCellPhoneExchanges b
  on left(a.phone,7) = b.CellPhonePrefix ----

update VAN_EAXXX_Contacts.dbo.contactsphones set IsCellPhoneExchange = 1
  from VAN_EAXXX_Contacts.dbo.contactsphones a join #TempContactsPhones b on a.ContactsPhoneID = b.ContactsPhoneID
  where B.IsCellPhoneExchange = 1 ----

--
declare @tbl tbltype_CSVInt
insert @tbl (ValueID)
select distinct vanid from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD
exec usp_UpdateContacts_PhoneID_Batch @tbl --
--
declare @tblEAXXX_Emails tbltype_CSVInt 

declare @tbl tbltype_CSVInt--
insert @tbl (ValueID)
select distinct vanid from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD
exec usp_UpdateContacts_PrivateEmailID_Batch @tbl
----
use van_EAXXX_contacts

--looks good
select top 1000 * from searchcombos

--looks good to me
select top 1000  * from districtfields

select top 1000 * from fieldhds

select top 1000 * from fieldsds

--this updates addresses, searchcombos, and districts
declare @tbl tbltype_CSVInt
insert @tbl (ValueID)
select distinct vanid from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD
exec usp_UpdateContacts_AddressID_Batch @tbl

--this updates the work addresses
declare @tbl tbltype_CSVInt
insert @tbl (ValueID)
select distinct vanid from staging.dbo.EAXXX_ClientNameSourceYYYYMMDD
exec usp_UpdateContacts_WorkAddressID_Batch @tbl
-----------------------------------------------------------------------------------------------------
use VAN_EAXXX_Contacts

select count(*) from contactsaddresses(nolock)

----also run unitcounts
usp_generateunitcounts

----also run HHSexCounts
usp_GenerateHHSexCounts

--it runs overnight
select top 1000 * from demographicfields

select top 1000 *--select count(*)
from contacts(nolock)
--where createdby='##' and YourNamek1 is null
where YourNamek1 is not null and createdby!='##'

alter table contacts drop column YourNamek1

select top 1000 *--select count(*)--
from EAXXX_ClientNameSourceYYYYMMDD
--------------------------------
--create every time in case they need it later
select * into EAXXX_ClientNameSourceYYYYMMDD_VanIDTranslator
from EAXXX_ClientNameSourceYYYYMMDD 

select top 1000 * from EAXXX_ClientNameSourceYYYYMMDD_VanIDTranslator

--i'd get rid of my clean up columns
alter table EAXXX_ClientNameSourceYYYYMMDD_VanIDTranslator drop column newphone,newphoneext,BadPhoneNote, k1